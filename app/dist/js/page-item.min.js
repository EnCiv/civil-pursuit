(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){!function Page_Item_Controller(){"use strict";var Synapp=require("syn/app");var SignComponent=require("syn/components/Sign/Controller");var PanelComponent=require("syn/components/Panel/Controller");window.app=new Synapp;app.ready(function(){(new SignComponent).render();var $panel=$(".panel[id]:last");var type=$panel.attr("id").split("-")[1];console.log("static type",type,$panel.attr("id"));var panel=new PanelComponent(type);panel.template=$(".panel[id]:last");panel.render(app.domain.intercept(function(){panel.template.find(".item[id]").each(function(){var id=$(this).attr("id").split("-")[1];var _item={_id:id,type:type,subject:$(this).find(".item-subject").text(),description:$(this).find(".item-description").text(),image:$(this).find(".item-media img").data("image"),references:[],views:+$(this).data("views"),promotions:+$(this).find(".promoted").text(),related:{Problem:+$(this).find(".related-count").text()}};console.log("tYPE",panel.template.attr("id").split("-")[1]);if($(this).find(".item-reference a").attr("url")!=="#"){_item.references[0]={url:$(this).find(".item-reference a").attr("url")};_item.references[0].title=$(this).find(".item-reference a").data("title")}var item=new Item(_item);item.template=$(this);item.render(app.domain.intercept(function onItemRendered(args){}))})}))})}()},{"syn/app":19,"syn/components/Panel/Controller":39,"syn/components/Sign/Controller":52}],2:[function(require,module,exports){module.exports=function(){var events=require("events");var domain={};domain.createDomain=domain.create=function(){var d=new events.EventEmitter;function emitError(e){d.emit("error",e)}d.add=function(emitter){emitter.on("error",emitError)};d.remove=function(emitter){emitter.removeListener("error",emitError)};d.bind=function(fn){return function(){var args=Array.prototype.slice.call(arguments);try{fn.apply(null,args)}catch(err){emitError(err)}}};d.intercept=function(fn){return function(err){if(err){emitError(err)}else{var args=Array.prototype.slice.call(arguments,1);try{fn.apply(null,args)}catch(err){emitError(err)}}}};d.run=function(fn){try{fn()}catch(err){emitError(err)}return this};d.dispose=function(){this.removeAllListeners();return this};d.enter=d.exit=function(){return this};return d};return domain}.call(this)},{events:3}],3:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}throw TypeError('Uncaught, unspecified "error" event.')}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}}else if(isObject(handler)){len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){var m;if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else{while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.listenerCount=function(emitter,type){var ret;if(!emitter._events||!emitter._events[type])ret=0;else if(isFunction(emitter._events[type]))ret=1;else ret=emitter._events[type].length;return ret};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],4:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],5:[function(require,module,exports){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!=="undefined"&&window.setImmediate;var canMutationObserver=typeof window!=="undefined"&&window.MutationObserver;var canPost=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)}}var queue=[];if(canMutationObserver){var hiddenDiv=document.createElement("div");var observer=new MutationObserver(function(){var queueList=queue.slice();queue.length=0;queueList.forEach(function(fn){fn()})});observer.observe(hiddenDiv,{attributes:true});return function nextTick(fn){if(!queue.length){hiddenDiv.setAttribute("yes","no")}queue.push(fn)}}if(canPost){window.addEventListener("message",function(ev){var source=ev.source;if((source===window||source===null)&&ev.data==="process-tick"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage("process-tick","*")}}return function nextTick(fn){setTimeout(fn,0)}}();process.title="browser";process.browser=true;process.env={};process.argv=[];function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")}},{}],6:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],7:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":6,_process:5,inherits:4}],8:[function(require,module,exports){"use strict";module.exports=require("./lib")},{"./lib":13}],9:[function(require,module,exports){"use strict";var asap=require("asap/raw");function noop(){}var LAST_ERROR=null;var IS_ERROR={};function getThen(obj){try{return obj.then}catch(ex){LAST_ERROR=ex;return IS_ERROR}}function tryCallOne(fn,a){try{return fn(a)}catch(ex){LAST_ERROR=ex;return IS_ERROR}}function tryCallTwo(fn,a,b){try{fn(a,b)}catch(ex){LAST_ERROR=ex;return IS_ERROR}}module.exports=Promise;function Promise(fn){if(typeof this!=="object"){throw new TypeError("Promises must be constructed via new")}if(typeof fn!=="function"){throw new TypeError("not a function")}this._32=0;this._8=null;this._89=[];if(fn===noop)return;doResolve(fn,this)}Promise._83=noop;Promise.prototype.then=function(onFulfilled,onRejected){if(this.constructor!==Promise){return safeThen(this,onFulfilled,onRejected)}var res=new Promise(noop);handle(this,new Handler(onFulfilled,onRejected,res));return res};function safeThen(self,onFulfilled,onRejected){return new self.constructor(function(resolve,reject){var res=new Promise(noop);res.then(resolve,reject);handle(self,new Handler(onFulfilled,onRejected,res))})}function handle(self,deferred){while(self._32===3){self=self._8}if(self._32===0){self._89.push(deferred);return}asap(function(){var cb=self._32===1?deferred.onFulfilled:deferred.onRejected;if(cb===null){if(self._32===1){resolve(deferred.promise,self._8)}else{reject(deferred.promise,self._8)}return}var ret=tryCallOne(cb,self._8);if(ret===IS_ERROR){reject(deferred.promise,LAST_ERROR)}else{resolve(deferred.promise,ret)}})}function resolve(self,newValue){if(newValue===self){return reject(self,new TypeError("A promise cannot be resolved with itself."))}if(newValue&&(typeof newValue==="object"||typeof newValue==="function")){var then=getThen(newValue);if(then===IS_ERROR){return reject(self,LAST_ERROR)}if(then===self.then&&newValue instanceof Promise){self._32=3;self._8=newValue;finale(self);return}else if(typeof then==="function"){doResolve(then.bind(newValue),self);return}}self._32=1;self._8=newValue;finale(self)}function reject(self,newValue){self._32=2;self._8=newValue;finale(self)}function finale(self){for(var i=0;i<self._89.length;i++){handle(self,self._89[i])}self._89=null}function Handler(onFulfilled,onRejected,promise){this.onFulfilled=typeof onFulfilled==="function"?onFulfilled:null;this.onRejected=typeof onRejected==="function"?onRejected:null;this.promise=promise}function doResolve(fn,promise){var done=false;var res=tryCallTwo(fn,function(value){if(done)return;done=true;resolve(promise,value)},function(reason){if(done)return;done=true;reject(promise,reason)});if(!done&&res===IS_ERROR){done=true;reject(promise,LAST_ERROR)}}},{"asap/raw":17}],10:[function(require,module,exports){"use strict";var Promise=require("./core.js");module.exports=Promise;Promise.prototype.done=function(onFulfilled,onRejected){var self=arguments.length?this.then.apply(this,arguments):this;self.then(null,function(err){setTimeout(function(){throw err},0)})}},{"./core.js":9}],11:[function(require,module,exports){"use strict";var Promise=require("./core.js");var asap=require("asap/raw");module.exports=Promise;var TRUE=valuePromise(true);var FALSE=valuePromise(false);var NULL=valuePromise(null);var UNDEFINED=valuePromise(undefined);var ZERO=valuePromise(0);var EMPTYSTRING=valuePromise("");function valuePromise(value){var p=new Promise(Promise._83);p._32=1;p._8=value;return p}Promise.resolve=function(value){if(value instanceof Promise)return value;if(value===null)return NULL;if(value===undefined)return UNDEFINED;if(value===true)return TRUE;if(value===false)return FALSE;if(value===0)return ZERO;if(value==="")return EMPTYSTRING;if(typeof value==="object"||typeof value==="function"){try{var then=value.then;if(typeof then==="function"){return new Promise(then.bind(value))}}catch(ex){return new Promise(function(resolve,reject){reject(ex)})}}return valuePromise(value)};Promise.all=function(arr){var args=Array.prototype.slice.call(arr);return new Promise(function(resolve,reject){if(args.length===0)return resolve([]);var remaining=args.length;function res(i,val){if(val&&(typeof val==="object"||typeof val==="function")){if(val instanceof Promise&&val.then===Promise.prototype.then){while(val._32===3){val=val._8}if(val._32===1)return res(i,val._8);if(val._32===2)reject(val._8);val.then(function(val){res(i,val)},reject);return}else{var then=val.then;if(typeof then==="function"){var p=new Promise(then.bind(val));p.then(function(val){res(i,val)},reject);return}}}args[i]=val;if(--remaining===0){resolve(args)}}for(var i=0;i<args.length;i++){res(i,args[i])}})};Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})};Promise.race=function(values){return new Promise(function(resolve,reject){values.forEach(function(value){Promise.resolve(value).then(resolve,reject)})})};Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)}},{"./core.js":9,"asap/raw":17}],12:[function(require,module,exports){"use strict";var Promise=require("./core.js");module.exports=Promise;Promise.prototype["finally"]=function(f){return this.then(function(value){return Promise.resolve(f()).then(function(){return value})},function(err){return Promise.resolve(f()).then(function(){throw err})})}},{"./core.js":9}],13:[function(require,module,exports){"use strict";module.exports=require("./core.js");require("./done.js");require("./finally.js");require("./es6-extensions.js");require("./node-extensions.js")},{"./core.js":9,"./done.js":10,"./es6-extensions.js":11,"./finally.js":12,"./node-extensions.js":14}],14:[function(require,module,exports){"use strict";var Promise=require("./core.js");var asap=require("asap");module.exports=Promise;Promise.denodeify=function(fn,argumentCount){argumentCount=argumentCount||Infinity;return function(){var self=this;var args=Array.prototype.slice.call(arguments);return new Promise(function(resolve,reject){while(args.length&&args.length>argumentCount){args.pop()}args.push(function(err,res){if(err)reject(err);else resolve(res)});var res=fn.apply(self,args);if(res&&(typeof res==="object"||typeof res==="function")&&typeof res.then==="function"){resolve(res)}})}};Promise.nodeify=function(fn){return function(){var args=Array.prototype.slice.call(arguments);var callback=typeof args[args.length-1]==="function"?args.pop():null;var ctx=this;try{return fn.apply(this,arguments).nodeify(callback,ctx)}catch(ex){if(callback===null||typeof callback=="undefined"){return new Promise(function(resolve,reject){reject(ex)})}else{asap(function(){callback.call(ctx,ex)})}}}};Promise.prototype.nodeify=function(callback,ctx){if(typeof callback!="function")return this;this.then(function(value){asap(function(){callback.call(ctx,null,value)})},function(err){asap(function(){callback.call(ctx,err)})})}},{"./core.js":9,asap:15}],15:[function(require,module,exports){"use strict";var rawAsap=require("./raw");var freeTasks=[];var pendingErrors=[];var requestErrorThrow=rawAsap.makeRequestCallFromTimer(throwFirstError);function throwFirstError(){if(pendingErrors.length){throw pendingErrors.shift()}}module.exports=asap;function asap(task){var rawTask;if(freeTasks.length){rawTask=freeTasks.pop()}else{rawTask=new RawTask}rawTask.task=task;rawAsap(rawTask)}function RawTask(){this.task=null}RawTask.prototype.call=function(){try{this.task.call()}catch(error){if(asap.onerror){asap.onerror(error)}else{pendingErrors.push(error);requestErrorThrow()}}finally{this.task=null;freeTasks[freeTasks.length]=this}}},{"./raw":16}],16:[function(require,module,exports){(function(global){"use strict";module.exports=rawAsap;function rawAsap(task){if(!queue.length){requestFlush();flushing=true}queue[queue.length]=task}var queue=[];var flushing=false;var requestFlush;var index=0;var capacity=1024;function flush(){while(index<queue.length){var currentIndex=index;index=index+1;queue[currentIndex].call();if(index>capacity){for(var scan=0,newLength=queue.length-index;scan<newLength;scan++){queue[scan]=queue[scan+index]}queue.length-=index;index=0}}queue.length=0;index=0;flushing=false}var BrowserMutationObserver=global.MutationObserver||global.WebKitMutationObserver;if(typeof BrowserMutationObserver==="function"){requestFlush=makeRequestCallFromMutationObserver(flush)}else{requestFlush=makeRequestCallFromTimer(flush)}rawAsap.requestFlush=requestFlush;function makeRequestCallFromMutationObserver(callback){var toggle=1;var observer=new BrowserMutationObserver(callback);var node=document.createTextNode("");observer.observe(node,{characterData:true});return function requestCall(){toggle=-toggle;node.data=toggle}}function makeRequestCallFromTimer(callback){return function requestCall(){var timeoutHandle=setTimeout(handleTimer,0);var intervalHandle=setInterval(handleTimer,50);function handleTimer(){clearTimeout(timeoutHandle);clearInterval(intervalHandle);callback()}}}rawAsap.makeRequestCallFromTimer=makeRequestCallFromTimer}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],17:[function(require,module,exports){(function(process){"use strict";var domain;var hasSetImmediate=typeof setImmediate==="function";module.exports=rawAsap;function rawAsap(task){if(!queue.length){requestFlush();flushing=true}queue[queue.length]=task}var queue=[];var flushing=false;var index=0;var capacity=1024;function flush(){while(index<queue.length){var currentIndex=index;index=index+1;queue[currentIndex].call();if(index>capacity){for(var scan=0,newLength=queue.length-index;scan<newLength;scan++){queue[scan]=queue[scan+index]}queue.length-=index;index=0}}queue.length=0;index=0;flushing=false}rawAsap.requestFlush=requestFlush;function requestFlush(){var parentDomain=process.domain;if(parentDomain){if(!domain){domain=require("domain")}domain.active=process.domain=null}if(flushing&&hasSetImmediate){setImmediate(flush)}else{process.nextTick(flush)}if(parentDomain){domain.active=process.domain=parentDomain}}}).call(this,require("_process"))},{_process:5,domain:2}],18:[function(require,module,exports){!function(){"use strict";var VERSION="2.2.0";var ENTITIES={};var latin_map={"Ã":"A","Ä‚":"A","áº®":"A","áº¶":"A","áº°":"A","áº²":"A","áº´":"A","Ç":"A","Ã‚":"A","áº¤":"A","áº¬":"A","áº¦":"A","áº¨":"A","áºª":"A","Ã„":"A","Çž":"A","È¦":"A","Ç ":"A","áº ":"A","È€":"A","Ã€":"A","áº¢":"A","È‚":"A","Ä€":"A","Ä„":"A","Ã…":"A","Çº":"A","á¸€":"A","Èº":"A","Ãƒ":"A","êœ²":"AA","Ã†":"AE","Ç¼":"AE","Ç¢":"AE","êœ´":"AO","êœ¶":"AU","êœ¸":"AV","êœº":"AV","êœ¼":"AY","á¸‚":"B","á¸„":"B","Æ":"B","á¸†":"B","Éƒ":"B","Æ‚":"B","Ä†":"C","ÄŒ":"C","Ã‡":"C","á¸ˆ":"C","Äˆ":"C","ÄŠ":"C","Æ‡":"C","È»":"C","ÄŽ":"D","á¸":"D","á¸’":"D","á¸Š":"D","á¸Œ":"D","ÆŠ":"D","á¸Ž":"D","Ç²":"D","Ç…":"D","Ä":"D","Æ‹":"D","Ç±":"DZ","Ç„":"DZ","Ã‰":"E","Ä”":"E","Äš":"E","È¨":"E","á¸œ":"E","ÃŠ":"E","áº¾":"E","á»†":"E","á»€":"E","á»‚":"E","á»„":"E","á¸˜":"E","Ã‹":"E","Ä–":"E","áº¸":"E","È„":"E","Ãˆ":"E","áºº":"E","È†":"E","Ä’":"E","á¸–":"E","á¸”":"E","Ä˜":"E","É†":"E","áº¼":"E","á¸š":"E","êª":"ET","á¸ž":"F","Æ‘":"F","Ç´":"G","Äž":"G","Ç¦":"G","Ä¢":"G","Äœ":"G","Ä ":"G","Æ“":"G","á¸ ":"G","Ç¤":"G","á¸ª":"H","Èž":"H","á¸¨":"H","Ä¤":"H","â±§":"H","á¸¦":"H","á¸¢":"H","á¸¤":"H","Ä¦":"H","Ã":"I","Ä¬":"I","Ç":"I","ÃŽ":"I","Ã":"I","á¸®":"I","Ä°":"I","á»Š":"I","Èˆ":"I","ÃŒ":"I","á»ˆ":"I","ÈŠ":"I","Äª":"I","Ä®":"I","Æ—":"I","Ä¨":"I","á¸¬":"I","ê¹":"D","ê»":"F","ê½":"G","êž‚":"R","êž„":"S","êž†":"T","ê¬":"IS","Ä´":"J","Éˆ":"J","á¸°":"K","Ç¨":"K","Ä¶":"K","â±©":"K","ê‚":"K","á¸²":"K","Æ˜":"K","á¸´":"K","ê€":"K","ê„":"K","Ä¹":"L","È½":"L","Ä½":"L","Ä»":"L","á¸¼":"L","á¸¶":"L","á¸¸":"L","â± ":"L","êˆ":"L","á¸º":"L","Ä¿":"L","â±¢":"L","Çˆ":"L","Å":"L","Ç‡":"LJ","á¸¾":"M","á¹€":"M","á¹‚":"M","â±®":"M","Åƒ":"N","Å‡":"N","Å…":"N","á¹Š":"N","á¹„":"N","á¹†":"N","Ç¸":"N","Æ":"N","á¹ˆ":"N","È ":"N","Ç‹":"N","Ã‘":"N","ÇŠ":"NJ","Ã“":"O","ÅŽ":"O","Ç‘":"O","Ã”":"O","á»":"O","á»˜":"O","á»’":"O","á»”":"O","á»–":"O","Ã–":"O","Èª":"O","È®":"O","È°":"O","á»Œ":"O","Å":"O","ÈŒ":"O","Ã’":"O","á»Ž":"O","Æ ":"O","á»š":"O","á»¢":"O","á»œ":"O","á»ž":"O","á» ":"O","ÈŽ":"O","êŠ":"O","êŒ":"O","ÅŒ":"O","á¹’":"O","á¹":"O","ÆŸ":"O","Çª":"O","Ç¬":"O","Ã˜":"O","Ç¾":"O","Ã•":"O","á¹Œ":"O","á¹Ž":"O","È¬":"O","Æ¢":"OI","êŽ":"OO","Æ":"E","Æ†":"O","È¢":"OU","á¹”":"P","á¹–":"P","ê’":"P","Æ¤":"P","ê”":"P","â±£":"P","ê":"P","ê˜":"Q","ê–":"Q","Å”":"R","Å˜":"R","Å–":"R","á¹˜":"R","á¹š":"R","á¹œ":"R","È":"R","È’":"R","á¹ž":"R","ÉŒ":"R","â±¤":"R","êœ¾":"C","ÆŽ":"E","Åš":"S","á¹¤":"S","Å ":"S","á¹¦":"S","Åž":"S","Åœ":"S","È˜":"S","á¹ ":"S","á¹¢":"S","á¹¨":"S","áºž":"SS","Å¤":"T","Å¢":"T","á¹°":"T","Èš":"T","È¾":"T","á¹ª":"T","á¹¬":"T","Æ¬":"T","á¹®":"T","Æ®":"T","Å¦":"T","â±¯":"A","êž€":"L","Æœ":"M","É…":"V","êœ¨":"TZ","Ãš":"U","Å¬":"U","Ç“":"U","Ã›":"U","á¹¶":"U","Ãœ":"U","Ç—":"U","Ç™":"U","Ç›":"U","Ç•":"U","á¹²":"U","á»¤":"U","Å°":"U","È”":"U","Ã™":"U","á»¦":"U","Æ¯":"U","á»¨":"U","á»°":"U","á»ª":"U","á»¬":"U","á»®":"U","È–":"U","Åª":"U","á¹º":"U","Å²":"U","Å®":"U","Å¨":"U","á¹¸":"U","á¹´":"U","êž":"V","á¹¾":"V","Æ²":"V","á¹¼":"V","ê ":"VY","áº‚":"W","Å´":"W","áº„":"W","áº†":"W","áºˆ":"W","áº€":"W","â±²":"W","áºŒ":"X","áºŠ":"X","Ã":"Y","Å¶":"Y","Å¸":"Y","áºŽ":"Y","á»´":"Y","á»²":"Y","Æ³":"Y","á»¶":"Y","á»¾":"Y","È²":"Y","ÉŽ":"Y","á»¸":"Y","Å¹":"Z","Å½":"Z","áº":"Z","â±«":"Z","Å»":"Z","áº’":"Z","È¤":"Z","áº”":"Z","Æµ":"Z","Ä²":"IJ","Å’":"OE","á´€":"A","á´":"AE","Ê™":"B","á´ƒ":"B","á´„":"C","á´…":"D","á´‡":"E","êœ°":"F","É¢":"G",
"Ê›":"G","Êœ":"H","Éª":"I","Ê":"R","á´Š":"J","á´‹":"K","ÊŸ":"L","á´Œ":"L","á´":"M","É´":"N","á´":"O","É¶":"OE","á´":"O","á´•":"OU","á´˜":"P","Ê€":"R","á´Ž":"N","á´™":"R","êœ±":"S","á´›":"T","â±»":"E","á´š":"R","á´œ":"U","á´ ":"V","á´¡":"W","Ê":"Y","á´¢":"Z","Ã¡":"a","Äƒ":"a","áº¯":"a","áº·":"a","áº±":"a","áº³":"a","áºµ":"a","ÇŽ":"a","Ã¢":"a","áº¥":"a","áº­":"a","áº§":"a","áº©":"a","áº«":"a","Ã¤":"a","ÇŸ":"a","È§":"a","Ç¡":"a","áº¡":"a","È":"a","Ã ":"a","áº£":"a","Èƒ":"a","Ä":"a","Ä…":"a","á¶":"a","áºš":"a","Ã¥":"a","Ç»":"a","á¸":"a","â±¥":"a","Ã£":"a","êœ³":"aa","Ã¦":"ae","Ç½":"ae","Ç£":"ae","êœµ":"ao","êœ·":"au","êœ¹":"av","êœ»":"av","êœ½":"ay","á¸ƒ":"b","á¸…":"b","É“":"b","á¸‡":"b","áµ¬":"b","á¶€":"b","Æ€":"b","Æƒ":"b","Éµ":"o","Ä‡":"c","Ä":"c","Ã§":"c","á¸‰":"c","Ä‰":"c","É•":"c","Ä‹":"c","Æˆ":"c","È¼":"c","Ä":"d","á¸‘":"d","á¸“":"d","È¡":"d","á¸‹":"d","á¸":"d","É—":"d","á¶‘":"d","á¸":"d","áµ­":"d","á¶":"d","Ä‘":"d","É–":"d","ÆŒ":"d","Ä±":"i","È·":"j","ÉŸ":"j","Ê„":"j","Ç³":"dz","Ç†":"dz","Ã©":"e","Ä•":"e","Ä›":"e","È©":"e","á¸":"e","Ãª":"e","áº¿":"e","á»‡":"e","á»":"e","á»ƒ":"e","á»…":"e","á¸™":"e","Ã«":"e","Ä—":"e","áº¹":"e","È…":"e","Ã¨":"e","áº»":"e","È‡":"e","Ä“":"e","á¸—":"e","á¸•":"e","â±¸":"e","Ä™":"e","á¶’":"e","É‡":"e","áº½":"e","á¸›":"e","ê«":"et","á¸Ÿ":"f","Æ’":"f","áµ®":"f","á¶‚":"f","Çµ":"g","ÄŸ":"g","Ç§":"g","Ä£":"g","Ä":"g","Ä¡":"g","É ":"g","á¸¡":"g","á¶ƒ":"g","Ç¥":"g","á¸«":"h","ÈŸ":"h","á¸©":"h","Ä¥":"h","â±¨":"h","á¸§":"h","á¸£":"h","á¸¥":"h","É¦":"h","áº–":"h","Ä§":"h","Æ•":"hv","Ã­":"i","Ä­":"i","Ç":"i","Ã®":"i","Ã¯":"i","á¸¯":"i","á»‹":"i","È‰":"i","Ã¬":"i","á»‰":"i","È‹":"i","Ä«":"i","Ä¯":"i","á¶–":"i","É¨":"i","Ä©":"i","á¸­":"i","êº":"d","ê¼":"f","áµ¹":"g","êžƒ":"r","êž…":"s","êž‡":"t","ê­":"is","Ç°":"j","Äµ":"j","Ê":"j","É‰":"j","á¸±":"k","Ç©":"k","Ä·":"k","â±ª":"k","êƒ":"k","á¸³":"k","Æ™":"k","á¸µ":"k","á¶„":"k","ê":"k","ê…":"k","Äº":"l","Æš":"l","É¬":"l","Ä¾":"l","Ä¼":"l","á¸½":"l","È´":"l","á¸·":"l","á¸¹":"l","â±¡":"l","ê‰":"l","á¸»":"l","Å€":"l","É«":"l","á¶…":"l","É­":"l","Å‚":"l","Ç‰":"lj","Å¿":"s","áºœ":"s","áº›":"s","áº":"s","á¸¿":"m","á¹":"m","á¹ƒ":"m","É±":"m","áµ¯":"m","á¶†":"m","Å„":"n","Åˆ":"n","Å†":"n","á¹‹":"n","Èµ":"n","á¹…":"n","á¹‡":"n","Ç¹":"n","É²":"n","á¹‰":"n","Æž":"n","áµ°":"n","á¶‡":"n","É³":"n","Ã±":"n","ÇŒ":"nj","Ã³":"o","Å":"o","Ç’":"o","Ã´":"o","á»‘":"o","á»™":"o","á»“":"o","á»•":"o","á»—":"o","Ã¶":"o","È«":"o","È¯":"o","È±":"o","á»":"o","Å‘":"o","È":"o","Ã²":"o","á»":"o","Æ¡":"o","á»›":"o","á»£":"o","á»":"o","á»Ÿ":"o","á»¡":"o","È":"o","ê‹":"o","ê":"o","â±º":"o","Å":"o","á¹“":"o","á¹‘":"o","Ç«":"o","Ç­":"o","Ã¸":"o","Ç¿":"o","Ãµ":"o","á¹":"o","á¹":"o","È­":"o","Æ£":"oi","ê":"oo","É›":"e","á¶“":"e","É”":"o","á¶—":"o","È£":"ou","á¹•":"p","á¹—":"p","ê“":"p","Æ¥":"p","áµ±":"p","á¶ˆ":"p","ê•":"p","áµ½":"p","ê‘":"p","ê™":"q","Ê ":"q","É‹":"q","ê—":"q","Å•":"r","Å™":"r","Å—":"r","á¹™":"r","á¹›":"r","á¹":"r","È‘":"r","É¾":"r","áµ³":"r","È“":"r","á¹Ÿ":"r","É¼":"r","áµ²":"r","á¶‰":"r","É":"r","É½":"r","â†„":"c","êœ¿":"c","É˜":"e","É¿":"r","Å›":"s","á¹¥":"s","Å¡":"s","á¹§":"s","ÅŸ":"s","Å":"s","È™":"s","á¹¡":"s","á¹£":"s","á¹©":"s","Ê‚":"s","áµ´":"s","á¶Š":"s","È¿":"s","É¡":"g","ÃŸ":"ss","á´‘":"o","á´“":"o","á´":"u","Å¥":"t","Å£":"t","á¹±":"t","È›":"t","È¶":"t","áº—":"t","â±¦":"t","á¹«":"t","á¹­":"t","Æ­":"t","á¹¯":"t","áµµ":"t","Æ«":"t","Êˆ":"t","Å§":"t","áµº":"th","É":"a","á´‚":"ae","Ç":"e","áµ·":"g","É¥":"h","Ê®":"h","Ê¯":"h","á´‰":"i","Êž":"k","êž":"l","É¯":"m","É°":"m","á´”":"oe","É¹":"r","É»":"r","Éº":"r","â±¹":"r","Ê‡":"t","ÊŒ":"v","Ê":"w","ÊŽ":"y","êœ©":"tz","Ãº":"u","Å­":"u","Ç”":"u","Ã»":"u","á¹·":"u","Ã¼":"u","Ç˜":"u","Çš":"u","Çœ":"u","Ç–":"u","á¹³":"u","á»¥":"u","Å±":"u","È•":"u","Ã¹":"u","á»§":"u","Æ°":"u","á»©":"u","á»±":"u","á»«":"u","á»­":"u","á»¯":"u","È—":"u","Å«":"u","á¹»":"u","Å³":"u","á¶™":"u","Å¯":"u","Å©":"u","á¹¹":"u","á¹µ":"u","áµ«":"ue","ê¸":"um","â±´":"v","êŸ":"v","á¹¿":"v","Ê‹":"v","á¶Œ":"v","â±±":"v","á¹½":"v","ê¡":"vy","áºƒ":"w","Åµ":"w","áº…":"w","áº‡":"w","áº‰":"w","áº":"w","â±³":"w","áº˜":"w","áº":"x","áº‹":"x","á¶":"x","Ã½":"y","Å·":"y","Ã¿":"y","áº":"y","á»µ":"y","á»³":"y","Æ´":"y","á»·":"y","á»¿":"y","È³":"y","áº™":"y","É":"y","á»¹":"y","Åº":"z","Å¾":"z","áº‘":"z","Ê‘":"z","â±¬":"z","Å¼":"z","áº“":"z","È¥":"z","áº•":"z","áµ¶":"z","á¶Ž":"z","Ê":"z","Æ¶":"z","É€":"z","ï¬€":"ff","ï¬ƒ":"ffi","ï¬„":"ffl","ï¬":"fi","ï¬‚":"fl","Ä³":"ij","Å“":"oe","ï¬†":"st","â‚":"a","â‚‘":"e","áµ¢":"i","â±¼":"j","â‚’":"o","áµ£":"r","áµ¤":"u","áµ¥":"v","â‚“":"x"};function initialize(object,s){if(s!==null&&s!==undefined){if(typeof s==="string")object.s=s;else object.s=s.toString()}else{object.s=s}object.orig=s;if(s!==null&&s!==undefined){if(object.__defineGetter__){object.__defineGetter__("length",function(){return object.s.length})}else{object.length=s.length}}else{object.length=-1}}function S(s){initialize(this,s)}var __nsp=String.prototype;var __sp=S.prototype={between:function(left,right){var s=this.s;var startPos=s.indexOf(left);var endPos=s.indexOf(right,startPos+left.length);if(endPos==-1&&right!=null)return new this.constructor("");else if(endPos==-1&&right==null)return new this.constructor(s.substring(startPos+left.length));else return new this.constructor(s.slice(startPos+left.length,endPos))},camelize:function(){var s=this.trim().s.replace(/(\-|_|\s)+(.)?/g,function(mathc,sep,c){return c?c.toUpperCase():""});return new this.constructor(s)},capitalize:function(){return new this.constructor(this.s.substr(0,1).toUpperCase()+this.s.substring(1).toLowerCase())},charAt:function(index){return this.s.charAt(index)},chompLeft:function(prefix){var s=this.s;if(s.indexOf(prefix)===0){s=s.slice(prefix.length);return new this.constructor(s)}else{return this}},chompRight:function(suffix){if(this.endsWith(suffix)){var s=this.s;s=s.slice(0,s.length-suffix.length);return new this.constructor(s)}else{return this}},collapseWhitespace:function(){var s=this.s.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"");return new this.constructor(s)},contains:function(ss){return this.s.indexOf(ss)>=0},count:function(ss){var count=0,pos=this.s.indexOf(ss);while(pos>=0){count+=1;pos=this.s.indexOf(ss,pos+1)}return count},dasherize:function(){var s=this.trim().s.replace(/[_\s]+/g,"-").replace(/([A-Z])/g,"-$1").replace(/-+/g,"-").toLowerCase();return new this.constructor(s)},latinise:function(){var s=this.replace(/[^A-Za-z0-9\[\] ]/g,function(x){return latin_map[x]||x});return new this.constructor(s)},decodeHtmlEntities:function(){var s=this.s;s=s.replace(/&#(\d+);?/g,function(_,code){return String.fromCharCode(code)}).replace(/&#[xX]([A-Fa-f0-9]+);?/g,function(_,hex){return String.fromCharCode(parseInt(hex,16))}).replace(/&([^;\W]+;?)/g,function(m,e){var ee=e.replace(/;$/,"");var target=ENTITIES[e]||e.match(/;$/)&&ENTITIES[ee];if(typeof target==="number"){return String.fromCharCode(target)}else if(typeof target==="string"){return target}else{return m}});return new this.constructor(s)},endsWith:function(){var suffixes=Array.prototype.slice.call(arguments,0);for(var i=0;i<suffixes.length;++i){var l=this.s.length-suffixes[i].length;if(l>=0&&this.s.indexOf(suffixes[i],l)===l)return true}return false},escapeHTML:function(){return new this.constructor(this.s.replace(/[&<>"']/g,function(m){return"&"+reversedEscapeChars[m]+";"}))},ensureLeft:function(prefix){var s=this.s;if(s.indexOf(prefix)===0){return this}else{return new this.constructor(prefix+s)}},ensureRight:function(suffix){var s=this.s;if(this.endsWith(suffix)){return this}else{return new this.constructor(s+suffix)}},humanize:function(){if(this.s===null||this.s===undefined)return new this.constructor("");var s=this.underscore().replace(/_id$/,"").replace(/_/g," ").trim().capitalize();return new this.constructor(s)},isAlpha:function(){return!/[^a-z\xDF-\xFF]|^$/.test(this.s.toLowerCase())},isAlphaNumeric:function(){return!/[^0-9a-z\xDF-\xFF]/.test(this.s.toLowerCase())},isEmpty:function(){return this.s===null||this.s===undefined?true:/^[\s\xa0]*$/.test(this.s)},isLower:function(){return this.isAlpha()&&this.s.toLowerCase()===this.s},isNumeric:function(){return!/[^0-9]/.test(this.s)},isUpper:function(){return this.isAlpha()&&this.s.toUpperCase()===this.s},left:function(N){if(N>=0){var s=this.s.substr(0,N);return new this.constructor(s)}else{return this.right(-N)}},lines:function(){return this.replaceAll("\r\n","\n").s.split("\n")},pad:function(len,ch){if(ch==null)ch=" ";if(this.s.length>=len)return new this.constructor(this.s);len=len-this.s.length;var left=Array(Math.ceil(len/2)+1).join(ch);var right=Array(Math.floor(len/2)+1).join(ch);return new this.constructor(left+this.s+right)},padLeft:function(len,ch){if(ch==null)ch=" ";if(this.s.length>=len)return new this.constructor(this.s);return new this.constructor(Array(len-this.s.length+1).join(ch)+this.s)},padRight:function(len,ch){if(ch==null)ch=" ";if(this.s.length>=len)return new this.constructor(this.s);return new this.constructor(this.s+Array(len-this.s.length+1).join(ch))},parseCSV:function(delimiter,qualifier,escape,lineDelimiter){delimiter=delimiter||",";escape=escape||"\\";if(typeof qualifier=="undefined")qualifier='"';var i=0,fieldBuffer=[],fields=[],len=this.s.length,inField=false,inUnqualifiedString=false,self=this;var ca=function(i){return self.s.charAt(i)};if(typeof lineDelimiter!=="undefined")var rows=[];if(!qualifier)inField=true;while(i<len){var current=ca(i);switch(current){case escape:if(inField&&(escape!==qualifier||ca(i+1)===qualifier)){i+=1;fieldBuffer.push(ca(i));break}if(escape!==qualifier)break;case qualifier:inField=!inField;break;case delimiter:if(inUnqualifiedString){inField=false;inUnqualifiedString=false}if(inField&&qualifier)fieldBuffer.push(current);else{fields.push(fieldBuffer.join(""));fieldBuffer.length=0}break;case lineDelimiter:if(inUnqualifiedString){inField=false;inUnqualifiedString=false;fields.push(fieldBuffer.join(""));rows.push(fields);fields=[];fieldBuffer.length=0}else if(inField){fieldBuffer.push(current)}else{if(rows){fields.push(fieldBuffer.join(""));rows.push(fields);fields=[];fieldBuffer.length=0}}break;case" ":if(inField)fieldBuffer.push(current);break;default:if(inField)fieldBuffer.push(current);else if(current!==qualifier){fieldBuffer.push(current);inField=true;inUnqualifiedString=true}break}i+=1}fields.push(fieldBuffer.join(""));if(rows){rows.push(fields);return rows}return fields},replaceAll:function(ss,r){var s=this.s.split(ss).join(r);return new this.constructor(s)},strip:function(){var ss=this.s;for(var i=0,n=arguments.length;i<n;i++){ss=ss.split(arguments[i]).join("")}return new this.constructor(ss)},right:function(N){if(N>=0){var s=this.s.substr(this.s.length-N,N);return new this.constructor(s)}else{return this.left(-N)}},setValue:function(s){initialize(this,s);return this},slugify:function(){var sl=new S(new S(this.s).latinise().s.replace(/[^\w\s-]/g,"").toLowerCase()).dasherize().s;if(sl.charAt(0)==="-")sl=sl.substr(1);return new this.constructor(sl)},startsWith:function(){var prefixes=Array.prototype.slice.call(arguments,0);for(var i=0;i<prefixes.length;++i){if(this.s.lastIndexOf(prefixes[i],0)===0)return true}return false},stripPunctuation:function(){return new this.constructor(this.s.replace(/[^\w\s]|_/g,"").replace(/\s+/g," "))},stripTags:function(){var s=this.s,args=arguments.length>0?arguments:[""];multiArgs(args,function(tag){s=s.replace(RegExp("</?"+tag+"[^<>]*>","gi"),"")});return new this.constructor(s)},template:function(values,opening,closing){var s=this.s;var opening=opening||Export.TMPL_OPEN;var closing=closing||Export.TMPL_CLOSE;var open=opening.replace(/[-[\]()*\s]/g,"\\$&").replace(/\$/g,"\\$");var close=closing.replace(/[-[\]()*\s]/g,"\\$&").replace(/\$/g,"\\$");var r=new RegExp(open+"(.+?)"+close,"g");var matches=s.match(r)||[];matches.forEach(function(match){var key=match.substring(opening.length,match.length-closing.length).trim();var value=typeof values[key]=="undefined"?"":values[key];s=s.replace(match,value)});return new this.constructor(s)},times:function(n){return new this.constructor(new Array(n+1).join(this.s))},toBoolean:function(){if(typeof this.orig==="string"){var s=this.s.toLowerCase();return s==="true"||s==="yes"||s==="on"||s==="1"}else return this.orig===true||this.orig===1},toFloat:function(precision){var num=parseFloat(this.s);if(precision)return parseFloat(num.toFixed(precision));else return num},toInt:function(){return/^\s*-?0x/i.test(this.s)?parseInt(this.s,16):parseInt(this.s,10)},trim:function(){var s;if(typeof __nsp.trim==="undefined")s=this.s.replace(/(^\s*|\s*$)/g,"");else s=this.s.trim();return new this.constructor(s)},trimLeft:function(){var s;if(__nsp.trimLeft)s=this.s.trimLeft();else s=this.s.replace(/(^\s*)/g,"");return new this.constructor(s)},trimRight:function(){var s;if(__nsp.trimRight)s=this.s.trimRight();else s=this.s.replace(/\s+$/,"");return new this.constructor(s)},truncate:function(length,pruneStr){var str=this.s;length=~~length;pruneStr=pruneStr||"...";if(str.length<=length)return new this.constructor(str);var tmpl=function(c){return c.toUpperCase()!==c.toLowerCase()?"A":" "},template=str.slice(0,length+1).replace(/.(?=\W*\w*$)/g,tmpl);if(template.slice(template.length-2).match(/\w\w/))template=template.replace(/\s*\S+$/,"");else template=new S(template.slice(0,template.length-1)).trimRight().s;return(template+pruneStr).length>str.length?new S(str):new S(str.slice(0,template.length)+pruneStr)},toCSV:function(){var delim=",",qualifier='"',escape="\\",encloseNumbers=true,keys=false;var dataArray=[];function hasVal(it){return it!==null&&it!==""}if(typeof arguments[0]==="object"){delim=arguments[0].delimiter||delim;delim=arguments[0].separator||delim;qualifier=arguments[0].qualifier||qualifier;encloseNumbers=!!arguments[0].encloseNumbers;escape=arguments[0].escape||escape;keys=!!arguments[0].keys}else if(typeof arguments[0]==="string"){delim=arguments[0]}if(typeof arguments[1]==="string")qualifier=arguments[1];if(arguments[1]===null)qualifier=null;if(this.orig instanceof Array)dataArray=this.orig;else{for(var key in this.orig)if(this.orig.hasOwnProperty(key))if(keys)dataArray.push(key);else dataArray.push(this.orig[key])}var rep=escape+qualifier;var buildString=[];for(var i=0;i<dataArray.length;++i){var shouldQualify=hasVal(qualifier);if(typeof dataArray[i]=="number")shouldQualify&=encloseNumbers;if(shouldQualify)buildString.push(qualifier);if(dataArray[i]!==null&&dataArray[i]!==undefined){var d=new S(dataArray[i]).replaceAll(qualifier,rep).s;buildString.push(d)}else buildString.push("");if(shouldQualify)buildString.push(qualifier);if(delim)buildString.push(delim)}buildString.length=buildString.length-1;return new this.constructor(buildString.join(""))},toString:function(){return this.s},underscore:function(){var s=this.trim().s.replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase();if(new S(this.s.charAt(0)).isUpper()){s="_"+s}return new this.constructor(s)},unescapeHTML:function(){return new this.constructor(this.s.replace(/\&([^;]+);/g,function(entity,entityCode){var match;if(entityCode in escapeChars){return escapeChars[entityCode]}else if(match=entityCode.match(/^#x([\da-fA-F]+)$/)){return String.fromCharCode(parseInt(match[1],16))}else if(match=entityCode.match(/^#(\d+)$/)){return String.fromCharCode(~~match[1])}else{return entity}}))},valueOf:function(){return this.s.valueOf()},wrapHTML:function(tagName,tagAttrs){var s=this.s,el=tagName==null?"span":tagName,elAttr="",wrapped="";if(typeof tagAttrs=="object")for(var prop in tagAttrs)elAttr+=" "+prop+'="'+new this.constructor(tagAttrs[prop]).escapeHTML()+'"';s=wrapped.concat("<",el,elAttr,">",this,"</",el,">");return new this.constructor(s)}};var methodsAdded=[];function extendPrototype(){for(var name in __sp){(function(name){var func=__sp[name];if(!__nsp.hasOwnProperty(name)){methodsAdded.push(name);__nsp[name]=function(){String.prototype.s=this;return func.apply(this,arguments)}}})(name)}}function restorePrototype(){for(var i=0;i<methodsAdded.length;++i)delete String.prototype[methodsAdded[i]];methodsAdded.length=0}var nativeProperties=getNativeStringProperties();for(var name in nativeProperties){(function(name){var stringProp=__nsp[name];if(typeof stringProp=="function"){if(!__sp[name]){if(nativeProperties[name]==="string"){__sp[name]=function(){return new this.constructor(stringProp.apply(this,arguments))}}else{__sp[name]=stringProp}}}})(name)}__sp.repeat=__sp.times;__sp.include=__sp.contains;__sp.toInteger=__sp.toInt;__sp.toBool=__sp.toBoolean;__sp.decodeHTMLEntities=__sp.decodeHtmlEntities;__sp.constructor=S;function getNativeStringProperties(){var names=getNativeStringPropertyNames();var retObj={};for(var i=0;i<names.length;++i){var name=names[i];var func=__nsp[name];try{var type=typeof func.apply("teststring",[]);retObj[name]=type}catch(e){}}return retObj}function getNativeStringPropertyNames(){var results=[];if(Object.getOwnPropertyNames){results=Object.getOwnPropertyNames(__nsp);results.splice(results.indexOf("valueOf"),1);results.splice(results.indexOf("toString"),1);return results}else{var stringNames={};var objectNames=[];for(var name in String.prototype)stringNames[name]=name;for(var name in Object.prototype)delete stringNames[name];for(var name in stringNames){results.push(name)}return results}}function Export(str){return new S(str)}Export.extendPrototype=extendPrototype;Export.restorePrototype=restorePrototype;Export.VERSION=VERSION;Export.TMPL_OPEN="{{";Export.TMPL_CLOSE="}}";Export.ENTITIES=ENTITIES;if(typeof module!=="undefined"&&typeof module.exports!=="undefined"){module.exports=Export}else{if(typeof define==="function"&&define.amd){define([],function(){return Export})}else{window.S=Export}}function multiArgs(args,fn){var result=[],i;for(i=0;i<args.length;i++){result.push(args[i]);if(fn)fn.call(args,args[i],i)}return result}var escapeChars={lt:"<",gt:">",quot:'"',apos:"'",amp:"&"};var reversedEscapeChars={};for(var key in escapeChars){reversedEscapeChars[escapeChars[key]]=key}ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,"OElig;":338,"oelig;":339,"Scaron;":352,"scaron;":353,"Yuml;":376,"fnof;":402,"circ;":710,"tilde;":732,"Alpha;":913,"Beta;":914,"Gamma;":915,"Delta;":916,"Epsilon;":917,"Zeta;":918,"Eta;":919,"Theta;":920,"Iota;":921,"Kappa;":922,"Lambda;":923,"Mu;":924,"Nu;":925,"Xi;":926,"Omicron;":927,"Pi;":928,"Rho;":929,"Sigma;":931,"Tau;":932,"Upsilon;":933,"Phi;":934,"Chi;":935,"Psi;":936,"Omega;":937,"alpha;":945,"beta;":946,"gamma;":947,"delta;":948,"epsilon;":949,"zeta;":950,"eta;":951,"theta;":952,"iota;":953,"kappa;":954,"lambda;":955,"mu;":956,"nu;":957,"xi;":958,"omicron;":959,"pi;":960,"rho;":961,"sigmaf;":962,"sigma;":963,"tau;":964,"upsilon;":965,"phi;":966,"chi;":967,"psi;":968,"omega;":969,"thetasym;":977,"upsih;":978,"piv;":982,"ensp;":8194,"emsp;":8195,"thinsp;":8201,"zwnj;":8204,"zwj;":8205,"lrm;":8206,"rlm;":8207,"ndash;":8211,"mdash;":8212,"lsquo;":8216,"rsquo;":8217,"sbquo;":8218,"ldquo;":8220,"rdquo;":8221,"bdquo;":8222,"dagger;":8224,"Dagger;":8225,"bull;":8226,"hellip;":8230,"permil;":8240,"prime;":8242,"Prime;":8243,"lsaquo;":8249,"rsaquo;":8250,"oline;":8254,"frasl;":8260,"euro;":8364,"image;":8465,"weierp;":8472,"real;":8476,"trade;":8482,"alefsym;":8501,"larr;":8592,"uarr;":8593,"rarr;":8594,"darr;":8595,"harr;":8596,"crarr;":8629,"lArr;":8656,"uArr;":8657,"rArr;":8658,"dArr;":8659,"hArr;":8660,"forall;":8704,"part;":8706,"exist;":8707,"empty;":8709,"nabla;":8711,"isin;":8712,"notin;":8713,"ni;":8715,"prod;":8719,"sum;":8721,"minus;":8722,"lowast;":8727,"radic;":8730,"prop;":8733,"infin;":8734,"ang;":8736,"and;":8743,"or;":8744,"cap;":8745,"cup;":8746,"int;":8747,"there4;":8756,"sim;":8764,"cong;":8773,"asymp;":8776,"ne;":8800,"equiv;":8801,"le;":8804,"ge;":8805,"sub;":8834,"sup;":8835,"nsub;":8836,"sube;":8838,"supe;":8839,"oplus;":8853,"otimes;":8855,"perp;":8869,"sdot;":8901,"lceil;":8968,"rceil;":8969,"lfloor;":8970,"rfloor;":8971,"lang;":9001,"rang;":9002,"loz;":9674,"spades;":9824,"clubs;":9827,"hearts;":9829,"diams;":9830}}.call(this)},{}],19:[function(require,module,exports){!function(){"use strict";var domain=require("domain");var Socket=require("syn/lib/app/Socket");var Cache=require("syn/lib/app/Cache");function Domain(onError){return domain.create().on("error",onError)}function Synapp(){var self=this;this.domain=new Domain(function(error){console.error("Synapp error",error.stack)});this.domain.intercept=function(fn,_self){if(typeof fn!=="function"){fn=function(){}}return function(error){if(error&&error instanceof Error){self.domain.emit("error",error)}else{var args=Array.prototype.slice.call(arguments);args.shift();fn.apply(_self,args)}}};this.location={};this.cache=new Cache;this.domain.run(function(){if(window.location.pathname){if(/^\/item\//.test(window.location.pathname)){self.location.item=window.location.pathname.split(/\//)[2]}}self.socket=new Socket(self.emit.bind(self)).socket})}require("util").inherits(Synapp,require("events").EventEmitter);Synapp.prototype.connect=function(fn){this.on("connect",fn);return this};Synapp.prototype.ready=function(fn){this.on("ready",fn);return this};if(module&&module.exports){module.exports=Synapp}if(typeof window==="object"){window.Synapp=Synapp}}()},{domain:2,events:3,"syn/lib/app/Cache":54,"syn/lib/app/Socket":56,util:7}],20:[function(require,module,exports){!function(){"use strict";module.exports=Creator;var Panel=require("syn/components/Panel/Controller");var text={"looking up title":"Looking up"};function Creator(panel){if(!app){throw new Error("Missing app")}if(!(panel instanceof require("syn/components/Panel/Controller"))){throw new Error("Creator: Panel must be a Panel object")}this.panel=panel;this.template=$("#"+this.panel.getId()).find(".creator:first")}Creator.prototype.find=function(name){switch(name){case"create button":return this.template.find(".button-create:first");case"form":return this.template.find("form");case"dropbox":return this.template.find(".drop-box");case"subject":return this.template.find('[name="subject"]');case"description":return this.template.find('[name="description"]');case"item media":return this.template.find(".item-media");case"reference":return this.template.find(".reference");case"reference board":return this.template.find(".reference-board");case"upload image button":return this.template.find(".upload-image-button")}};Creator.prototype.render=require("syn/components/Creator/controllers/render");Creator.prototype.create=require("syn/components/Creator/controllers/create");Creator.prototype.created=require("syn/components/Creator/controllers/created");Creator.prototype.packItem=require("syn/components/Creator/controllers/pack-item")}()},{"syn/components/Creator/controllers/create":21,"syn/components/Creator/controllers/created":22,"syn/components/Creator/controllers/pack-item":23,"syn/components/Creator/controllers/render":24,"syn/components/Panel/Controller":39}],21:[function(require,module,exports){(function(process){!function(){"use strict";var Nav=require("syn/lib/util/Nav");var Item=require("syn/components/Item/Controller");var Stream=require("syn/lib/util/Stream");function save(){var creator=this;process.nextTick(function(){app.domain.run(function(){Nav.hide(creator.template).error(app.domain.intercept()).hidden(function(){creator.packItem();if(creator.packaged.upload){var file=creator.template.find(".preview-image").data("file");new Stream(file).on("error",app.domain.intercept(function(){})).on("end",function(){creator.packaged.image=file.name;console.log("create item",creator.packaged);app.socket.emit("create item",creator.packaged)})}else{console.log("create item",creator.packaged);app.socket.publish("create item",creator.packaged,creator.created.bind(creator))}app.socket.once("could not create item",app.domain.intercept())})})});return false}module.exports=save}()}).call(this,require("_process"))},{_process:5,"syn/components/Item/Controller":29,"syn/lib/util/Nav":58,"syn/lib/util/Stream":60}],22:[function(require,module,exports){!function(){"use strict";function created(item){console.log("created item",item);this.panel.template.find(".create-new").hide();if(this.packaged.upload){item.upload=this.packaged.upload}if(this.packaged.youtube){item.youtube=this.packaged.youtube}var item=new(require("syn/components/Item/Controller"))(item);var items=this.panel.find("items");item.load(app.domain.intercept(function(){item.template.addClass("new");items.prepend(item.template);item.render(app.domain.intercept(function(){item.find("toggle promote").click()}))}))}module.exports=created}()},{"syn/components/Item/Controller":29}],23:[function(require,module,exports){!function(){"use strict";function packItem(){var item={type:this.panel.type,subject:this.find("subject").val(),description:this.find("description").val(),user:synapp.user};if(this.panel.parent){item.parent=this.panel.parent}if(this.find("reference").val()){item.references=[{url:this.find("reference").val()}];if(this.find("reference board").text()&&this.find("reference board").text()!=="Looking up title"){item.references[0].title=this.find("reference board").text()}}if(this.find("item media").find("img").length){if(this.find("item media").find(".youtube-preview").length){item.youtube=this.find("item media").find(".youtube-preview").data("video")}else{item.upload=this.find("item media").find("img").attr("src");item.image=item.upload}}this.packaged=item}module.exports=packItem}();synapp.user},{}],24:[function(require,module,exports){!function(){"use strict";var Promise=require("promise");var __Upload=require("syn/lib/util/Upload");var __Form=require("syn/lib/util/Form");var __YouTube=require("syn/components/YouTube/Controller");var domainRun=require("syn/lib/util/domain-run");function render(cb){var comp=this;var q=new Promise(function(fulfill,reject){domainRun(function(d){if(!comp.template.length){throw new Error("Creator not found in panel "+comp.panel.getId())}comp.template.data("creator",comp);comp.find("upload image button").on("click",function(){comp.find("dropbox").find('[type="file"]').click()});new __Upload(comp.find("dropbox"),comp.find("dropbox").find("input"),comp.find("dropbox"));comp.template.find("textarea").autogrow();comp.find("reference").on("change",function(){var creator=$(this).closest(".creator").data("creator");var board=creator.find("reference board");var reference=$(this);board.removeClass("hide").text("Looking up title");app.socket.emit("get url title",$(this).val(),function(error,ref){if(ref.title){board.text(ref.title);reference.data("title",ref.title);var yt=__YouTube(ref.url);if(yt){creator.find("dropbox").hide();creator.find("item media").empty().append(yt)}}else{board.text("Looking up").addClass("hide")}})});var form=new __Form(comp.template);form.send(comp.create.bind(comp));fulfill()},reject)});if(typeof cb==="function"){q.then(cb.bind(null,null),cb)}return q}module.exports=render}()},{promise:8,"syn/components/YouTube/Controller":53,"syn/lib/util/Form":57,"syn/lib/util/Upload":61,"syn/lib/util/domain-run":62}],25:[function(require,module,exports){!function _DetailsComponent_(){"use strict";var EditComponent=require("syn/components/EditAndGoAgain/Controller");var NavProvider=require("syn/lib/util/Nav");function DetailsComponent(item){if(!app){throw new Error("Missing app")}var self=this;app.domain.run(function(){if(!item||!item instanceof require("syn/components/Item/Controller")){throw new Error("Item must be an Item")}self.item=item;self.template=item.find("details");if(!self.template.length){throw new Error("Details template not found")}})}DetailsComponent.prototype.find=function(name){switch(name){case"promoted bar":return this.template.find(".progress");case"feedback list":return this.template.find(".feedback-list");case"votes":return this.template.find(".details-votes");case"toggle edit and go again":return this.template.find(".edit-and-go-again-toggler")}};DetailsComponent.prototype.render=function(cb){var self=this;var item=self.item.item;self.find("promoted bar").goalProgress({goalAmount:100,currentAmount:Math.floor(item.promotions*100/item.views),textBefore:"",textAfter:"%"});self.find("toggle edit and go again").on("click",function(){NavProvider.unreveal(self.template,self.item.template,app.domain.intercept(function(){if(self.item.find("editor").find("form").length){console.warn("already loaded")}else{var edit=new EditComponent(self.item);edit.get(app.domain.intercept(function(template){self.item.find("editor").find(".is-section").append(template);NavProvider.reveal(self.item.find("editor"),self.item.template,app.domain.intercept(function(){NavProvider.show(template,app.domain.intercept(function(){edit.render()}))}))}))}}))});if(app.socket.synuser){$(".is-in").removeClass("is-in")}if(!self.details){this.get()}};DetailsComponent.prototype.votes=function(criteria,svg){var self=this;setTimeout(function(){var vote=self.details.votes[criteria._id];svg.attr("id","chart-"+self.details.item._id+"-"+criteria._id);var data=[];if(!vote){vote={values:{"-1":0,0:0,1:0},total:0}}for(var number in vote.values){data.push({label:"number",value:vote.values[number]*100/vote.total})}var columns=["votes"];data.forEach(function(d){columns.push(d.value)});var chart=c3.generate({bindto:"#"+svg.attr("id"),data:{x:"x",columns:[["x",-1,0,1],columns],type:"bar"},grid:{x:{lines:3}},axis:{x:{},y:{max:90,show:false,tick:{count:5,format:function(y){return y}}}},size:{height:80},bar:{width:$(window).width()/5}})},250)};DetailsComponent.prototype.get=function(){var self=this;app.socket.publish("get item details",self.item.item._id,function(details){console.log("got item details",details);self.details=details;details.feedbacks.forEach(function(feedback){var tpl=$('<div class="pretext feedback"></div>');tpl.text(feedback.feedback);self.find("feedback list").append(tpl).append("<hr/>")});details.criterias.forEach(function(criteria,i){self.find("votes").eq(i).find("h4").text(criteria.name);self.votes(criteria,self.find("votes").eq(i).find("svg"))})})};module.exports=DetailsComponent}()},{"syn/components/EditAndGoAgain/Controller":26,"syn/components/Item/Controller":29,"syn/lib/util/Nav":58}],26:[function(require,module,exports){!function Component_EditAndGoAgain_Controller(){"use strict";var Nav=require("syn/lib/util/Nav");var Creator=require("syn/components/Creator/Controller");var Item=require("syn/components/Item/Controller");var Form=require("syn/lib/util/Form");function Edit(item){console.log("EDIT",item);if(!app){throw new Error("Missing app")}var self=this;app.domain.run(function(){if(!item||!item instanceof require("syn/components/Item/Controller")){throw new Error("Item must be an Item")}self.item=item})}Edit.prototype.get=function(cb){var edit=this;$.ajax({url:"/partial/creator"}).error(cb).success(function(data){edit.template=$(data);cb(null,edit.template)});return this};Edit.prototype.find=function(name){switch(name){case"create button":return this.template.find(".button-create:first");case"dropbox":return this.template.find(".drop-box");case"subject":return this.template.find('[name="subject"]');case"description":return this.template.find('[name="description"]');case"item media":return this.template.find(".item-media");case"reference":return this.template.find(".reference");case"reference board":return this.template.find(".reference-board")}};Edit.prototype.render=function(cb){var edit=this;this.template.find('[name="subject"]').val(edit.item.item.subject);this.template.find('[name="description"]').val(edit.item.item.description).autogrow();if(edit.item.item.references.length){this.template.find('[name="reference"]').val(edit.item.item.references[0].url)}this.template.find(".item-media").empty().append(edit.item.media());var form=new Form(this.template);
form.send(edit.save);return this};Edit.prototype.save=require("syn/components/EditAndGoAgain/controllers/save");Edit.prototype.toItem=function(){var item={from:this.item.item._id,subject:this.find("subject").val(),description:this.find("description").val(),user:synapp.user,type:this.item.item.type};if(this.find("item media").find("img").length){if(this.find("item media").find(".youtube-preview").length){item.youtube=this.find("item media").find(".youtube-preview").data("video")}else{item.upload=this.find("item media").find("img").attr("src")}}return item};module.exports=Edit}()},{"syn/components/Creator/Controller":20,"syn/components/EditAndGoAgain/controllers/save":27,"syn/components/Item/Controller":29,"syn/lib/util/Form":57,"syn/lib/util/Nav":58}],27:[function(require,module,exports){!function(){"use strict";var Nav=require("syn/lib/util/Nav");function save(){var edit=this;console.log(edit.toItem());Nav.hide(edit.template,app.domain.intercept(function(){Nav.hide(edit.template.closest(".editor"),app.domain.intercept(function(){var new_item=edit.toItem();app.socket.emit("create item",new_item);app.socket.once("could not create item",function(error){console.error(error)});app.socket.once("created item",function(item){console.log("created item",item);if(new_item.upload){item.upload=new_item.upload}if(new_item.youtube){item.youtube=new_item.youtube}var item=new(require("syn/components/Item/Controller"))(item);item.load(app.domain.intercept(function(){item.template.insertBefore(edit.item.template);item.render(app.domain.intercept(function(){item.find("toggle promote").click()}))}))})}))}))}module.exports=save}()},{"syn/components/Item/Controller":29,"syn/lib/util/Nav":58}],28:[function(require,module,exports){!function(){"use strict";var Form=require("syn/lib/util/Form");function forgotPassword($vexContent){var signForm=$('form[name="forgot-password"]');var form=new Form(signForm);form.send(function(){var domain=require("domain").create();domain.on("error",function(error){});domain.run(function(){$(".forgot-password-pending.hide").removeClass("hide");$(".forgot-password-email-not-found").not(".hide").addClass("hide");$(".forgot-password-ok").not(".hide").addClass("hide");app.socket.once("no such email",function(_email){if(_email===form.labels.email.val()){$(".forgot-password-pending").addClass("hide");setTimeout(function(){});$(".forgot-password-email-not-found").removeClass("hide")}});app.socket.on("password is resettable",function(_email){if(_email===form.labels.email.val()){$(".forgot-password-pending").addClass("hide");$(".forgot-password-ok").removeClass("hide");setTimeout(function(){vex.close($vexContent.data().vex.id)},2500)}});app.socket.emit("send password",form.labels.email.val())})})}module.exports=forgotPassword}()},{domain:2,"syn/lib/util/Form":57}],29:[function(require,module,exports){!function Component_Item_Controller(){"use strict";function Item(item){if(typeof app==="undefined"||!(app instanceof Synapp)){throw new Error("Missing app")}var self=this;app.domain.run(function(){if(typeof item!=="object"){throw new Error("Item must be an object")}self.item=item})}Item.prototype.load=require("syn/components/Item/controllers/load");Item.prototype.find=require("syn/components/Item/controllers/find");Item.prototype.render=require("syn/components/Item/controllers/render");Item.prototype.media=require("syn/components/Item/controllers/media");Item.cache={template:undefined};module.exports=Item}()},{"syn/components/Item/controllers/find":30,"syn/components/Item/controllers/load":31,"syn/components/Item/controllers/media":32,"syn/components/Item/controllers/render":33}],30:[function(require,module,exports){!function(){"use strict";function find(name){var comp=this;switch(name){case"subject":return this.template.find(".item-subject a");case"description":return this.template.find(".description");case"toggle promote":return this.template.find(".item-toggle-promote");case"promote":return this.template.find(".promote");case"reference":return this.template.find(".item-reference:first a");case"media":return this.template.find(".item-media:first");case"youtube preview":return this.template.find(".youtube-preview:first");case"toggle details":return this.template.find(".item-toggle-details:first");case"details":return this.template.find(".details:first");case"editor":return this.template.find(".editor:first");case"toggle arrow":return this.template.find(".item-arrow:first");case"promotions":return this.template.find(".promoted:first");case"promotions %":return this.template.find(".promoted-percent:first");case"children":return this.template.find(".children:first");case"collapsers":return this.template.find(".item-collapsers:first");case"collapsers hidden":return this.template.find(".item-collapsers:first:hidden");case"collapsers visible":return this.template.find(".item-collapsers:first:visible");case"related count":return this.template.find(".related-count");case"related":return this.template.find(".related");case"related count plural":return this.template.find(".related-count-plural");case"related name":return this.template.find(".related-name")}}module.exports=find}()},{}],31:[function(require,module,exports){!function(){"use strict";function load(cb){var item=this;if(app.cache.get("/views/Item")){item.template=$(app.cache.get("/views/Item")[0].outerHTML);if(cb){cb(null,item.template)}return}$.ajax({url:"/views/Item"}).error(cb).success(function(data){item.template=$(data);app.cache.set("/views/Item",item.template);cb(null,item.template)});return this}module.exports=load}()},{}],32:[function(require,module,exports){!function(){"use strict";var YouTube=require("syn/components/YouTube/Controller");function itemMedia(){if(this.item.references&&this.item.references.length){var media=YouTube(this.item.references[0].url);if(media){return media}}if(this.item.adjustImage){console.info("adjustImage");return $(this.item.adjustImage.replace(/\>$/,' class="img-responsive" />'))}if(this.item.image&&/^http/.test(this.item.image)){var src=this.item.image;var image=$("<img/>");image.addClass("img-responsive");image.attr("src",src);return image}if(this.item.youtube){return YouTube("http://youtube.com/watch?v="+this.item.youtube)}if(this.item.upload){var src=this.item.image;var image=$("<img/>");image.addClass("img-responsive");image.attr("src",this.item.upload);return image}var image=$("<img/>");image.addClass("img-responsive");image.attr("src",synapp["default item image"]);return image}module.exports=itemMedia}()},{"syn/components/YouTube/Controller":53}],33:[function(require,module,exports){!function(){"use strict";var Promote=require("syn/components/Promote/Controller");var Details=require("syn/components/Details/Controller");var Nav=require("syn/lib/util/Nav");var readMore=require("syn/lib/util/ReadMore");var Sign=require("syn/components/Sign/Controller");var togglePromote=require("syn/components/Item/events/toggle-promote");var S=require("string");function makeRelated(){var button=$('<button class="shy counter"><span class="related-number"></span> <i class="fa"></i></button>');return button}function render(cb){var item=this;this.promote=new Promote(this);this.details=new Details(this);item.template.attr("id","item-"+item.item._id);item.template.data("item",this);"SUBJECT";item.find("subject").attr("href","/item/"+item.item.id+"/"+S(item.item.subject).slugify().s).text(item.item.subject).on("click",function(e){var link=$(this);var item=link.closest(".item");Nav.scroll(item,function(){history.pushState(null,null,link.attr("href"));item.find(".item-text .more").click()});return false});"DESCRIPTION";item.find("description").text(item.item.description);"MEDIA";if(!item.find("media").find("img[data-rendered]").length){item.find("media").empty().append(this.media())}"READ MORE";item.find("media").find("img").on("load",function(){if(!this.template.find(".more").length){readMore(this.item,this.template)}}.bind(item));"REFERENCES";if(item.item.references&&item.item.references.length){item.find("reference").attr("href",item.item.references[0].url).text(item.item.references[0].title||item.item.references[0].url)}else{item.find("reference").empty()}"PROMOTIONS";item.find("promotions").text(item.item.promotions);"POPULARITY";item.find("promotions %").text((item.item.popularity.number||0)+"%");"CHILDREN";var buttonChildren=makeRelated();buttonChildren.addClass("children-count");buttonChildren.find("i").addClass("fa-fire");buttonChildren.find(".related-number").text(item.item.children);item.find("related").append(buttonChildren);"HARMONY";if("harmony"in item.item){var buttonHarmony=makeRelated();buttonHarmony.find("i").addClass("fa-music");buttonHarmony.find(".related-number").text(item.item.harmony);item.find("related").append(buttonHarmony)}item.template.find(".counter").on("click",function(){var $trigger=$(this);var $item=$trigger.closest(".item");var item=$item.data("item");item.find("toggle arrow").click()});"TOGGLE PROMOTE";item.find("toggle promote").on("click",togglePromote);"TOGGLE DETAILS";item.find("toggle details").on("click",require("syn/components/Item/events/toggle-details"));"TOGGLE ARROW";item.find("toggle arrow").removeClass("hide").on("click",require("syn/components/Item/events/toggle-arrow"));cb()}module.exports=render}()},{string:18,"syn/components/Details/Controller":25,"syn/components/Item/events/toggle-arrow":34,"syn/components/Item/events/toggle-details":35,"syn/components/Item/events/toggle-promote":36,"syn/components/Promote/Controller":45,"syn/components/Sign/Controller":52,"syn/lib/util/Nav":58,"syn/lib/util/ReadMore":59}],34:[function(require,module,exports){!function(){"use strict";function toggleArrow(){var $item=$(this).closest(".item");var item=$item.data("item");var arrow=$(this).find("i");if(item.find("collapsers hidden").length){item.find("collapsers").show()}require("syn/lib/util/Nav").toggle(item.find("children"),item.template,app.domain.intercept(function(){console.log("item type",item.item.type);if(item.find("children").hasClass("is-hidden")&&item.find("collapsers visible").length){item.find("collapsers").hide()}if(item.find("children").hasClass("is-shown")&&!item.find("children").hasClass("is-loaded")){item.find("children").addClass("is-loaded");console.log("we have an item",item.item.subtype);var subtype=item.item.subtype;if(subtype){var subPanel=new(require("syn/components/Panel/Controller"))(subtype,item.item._id);subPanel.load(app.domain.intercept(function(template){item.find("children").append(template);setTimeout(function(){subPanel.render(app.domain.intercept(function(){subPanel.fill(app.domain.intercept())}))})}))}}if(arrow.hasClass("fa-arrow-down")){arrow.removeClass("fa-arrow-down").addClass("fa-arrow-up")}else{arrow.removeClass("fa-arrow-up").addClass("fa-arrow-down")}}))}module.exports=toggleArrow}()},{"syn/components/Panel/Controller":39,"syn/lib/util/Nav":58}],35:[function(require,module,exports){!function(){"use strict";function toggleDetails(){var $trigger=$(this);var $item=$trigger.closest(".item");var item=$item.data("item");function showHideCaret(){if(item.find("details").hasClass("is-shown")){$trigger.find(".caret").removeClass("hide")}else{$trigger.find(".caret").addClass("hide")}}if(item.find("promote").hasClass("is-showing")){return false}if(item.find("promote").hasClass("is-shown")){item.find("toggle promote").find(".caret").addClass("hide");require("syn/lib/util/Nav").hide(item.find("promote"))}var hiders=$(".details.is-shown");if(item.find("collapsers hidden").length){item.find("collapsers").show()}require("syn/lib/util/Nav").toggle(item.find("details"),item.template,app.domain.intercept(function(){showHideCaret();if(item.find("details").hasClass("is-hidden")&&item.find("collapsers visible").length){item.find("collapsers").hide()}if(item.find("details").hasClass("is-shown")){if(!item.find("details").hasClass("is-loaded")){item.find("details").addClass("is-loaded");item.details.render(app.domain.intercept())}if(hiders.length){require("syn/lib/util/Nav").hide(hiders)}}}))}module.exports=toggleDetails}()},{"syn/lib/util/Nav":58}],36:[function(require,module,exports){!function(){"use strict";var Nav=require("syn/lib/util/Nav");var Sign=require("syn/components/Sign/Controller");function togglePromote(){if(!app.socket.synuser){Sign.dialog.join();return}var $trigger=$(this);var $item=$trigger.closest(".item");var item=$item.data("item");function hideOthers(){if($(".is-showing").length||$(".is-hidding").length){return false}if($(".creator.is-shown").length){Nav.hide($(".creator.is-shown")).hidden(function(){$trigger.click()});return false}if(item.find("details").hasClass("is-shown")){Nav.hide(item.find("details")).hidden(function(){$trigger.click()});item.find("toggle details").find(".caret").addClass("hide");return false}}function promote(){item.promote.get(app.domain.intercept(item.promote.render.bind(item.promote)))}function showHideCaret(){if(item.find("promote").hasClass("is-shown")){$trigger.find(".caret").removeClass("hide")}else{$trigger.find(".caret").addClass("hide")}}if(hideOthers()===false){return false}if(item.find("collapsers hidden").length){item.find("collapsers").show()}Nav.toggle(item.find("promote"),item.template,function(error){if(item.find("promote").hasClass("is-hidden")&&item.find("collapsers visible").length){item.find("collapsers").hide()}promote();showHideCaret()})}module.exports=togglePromote}()},{"syn/components/Sign/Controller":52,"syn/lib/util/Nav":58}],37:[function(require,module,exports){!function(){"use strict";var Form=require("syn/lib/util/Form");function join($vexContent){var $form=$('form[name="join"]');$form.find(".i-agree").on("click",function(){var agreed=$(this).find(".agreed");if(agreed.hasClass("fa-square-o")){agreed.removeClass("fa-square-o").addClass("fa-check-square-o")}else{agreed.removeClass("fa-check-square-o").addClass("fa-square-o")}});var form=new Form($form);function join(){app.domain.run(function(){$form.find(".please-agree").addClass("hide");$form.find(".already-taken").hide();if(form.labels.password.val()!==form.labels.confirm.val()){form.labels.confirm.focus().addClass("error");return}if(!$form.find(".agreed").hasClass("fa-check-square-o")){$form.find(".please-agree").removeClass("hide");return}$.ajax({url:"/sign/up",type:"POST",data:{email:form.labels.email.val(),password:form.labels.password.val()}}).error(function(response,state,code){if(response.status===401){$form.find(".already-taken").show()}}).success(function(response){synapp.user=response.user;$("a.is-in").css("display","inline");$(".topbar .is-out").remove();vex.close($vexContent.data().vex.id)})})}form.send(join)}module.exports=join}()},{"syn/lib/util/Form":57}],38:[function(require,module,exports){!function(){"use strict";var Form=require("syn/lib/util/Form");var Nav=require("syn/lib/util/Nav");function login($vexContent){var signForm=$('form[name="login"]');var form=new Form(signForm);function login(){app.domain.run(function(){if($(".login-error-404").hasClass("is-shown")){return Nav.hide($(".login-error-404"),app.domain.intercept(function(){form.send(login);form.form.submit()}))}if($(".login-error-401").hasClass("is-shown")){return Nav.hide($(".login-error-401"),app.domain.intercept(function(){form.send(login);form.form.submit()}))}$.ajax({url:"/sign/in",type:"POST",data:{email:form.labels.email.val(),password:form.labels.password.val()}}).error(function(response){switch(response.status){case 404:Nav.show($(".login-error-404"));break;case 401:Nav.show($(".login-error-401"));break}}).success(function(response){synapp.user=response.user;$("a.is-in").css("display","inline");$(".topbar .is-out").remove();vex.close($vexContent.data().vex.id)})})}form.send(login)}module.exports=login}()},{"syn/lib/util/Form":57,"syn/lib/util/Nav":58}],39:[function(require,module,exports){!function _PanelComponent_(){"use strict";var Nav=require("syn/lib/util/Nav");var Session=require("syn/lib/app/Session");var Creator=require("syn/components/Creator/Controller");var Item=require("syn/components/Item/Controller");var Sign=require("syn/components/Sign/Controller");function Panel(type,parent,size,skip){if(!app){throw new Error("Missing app")}var panel=this;this.type=type;this.parent=parent;this.skip=skip||0;this.size=size||synapp["navigator batch size"];this.id="panel-"+(this.type._id||this.type);if(this.parent){this.id+="-"+this.parent}}Panel.prototype.getId=function(){return this.id};Panel.prototype.load=require("syn/components/Panel/controllers/load");Panel.prototype.find=function(name){switch(name){case"title":return this.template.find(".panel-title:first");case"toggle creator":return this.template.find(".toggle-creator:first");case"creator":return this.template.find(".creator:first");case"items":return this.template.find(".items:first");case"load more":return this.template.find(".load-more:first");case"create new":return this.template.find(".create-new:first")}};Panel.prototype.toggleCreator=function(target){console.info("is in",Session.isIn());if(Session.isIn()){Nav.toggle(this.find("creator"),this.template,app.domain.intercept())}else{Sign.dialog.join()}};Panel.prototype.render=require("syn/components/Panel/controllers/render");Panel.prototype.toJSON=require("syn/components/Panel/controllers/to-json");Panel.prototype.fill=require("syn/components/Panel/controllers/fill");Panel.prototype.preInsertItem=require("syn/components/Panel/controllers/pre-insert-item");Panel.prototype.insertItem=function(items,i,cb){var self=this;if(items[i]){var item=new Item(items[i]);console.log("inserting item ",i,item);item.load(app.domain.intercept(function(template){self.find("items").append(template);item.render(app.domain.intercept(function(){self.insertItem(items,++i,cb)}))}))}else{cb&&cb()}};module.exports=Panel}()},{"syn/components/Creator/Controller":20,"syn/components/Item/Controller":29,"syn/components/Panel/controllers/fill":40,"syn/components/Panel/controllers/load":41,"syn/components/Panel/controllers/pre-insert-item":42,"syn/components/Panel/controllers/render":43,"syn/components/Panel/controllers/to-json":44,"syn/components/Sign/Controller":52,"syn/lib/app/Session":55,"syn/lib/util/Nav":58}],40:[function(require,module,exports){!function(){"use strict";function fill(item,cb){var self=this;if(typeof item==="function"&&!cb){cb=item;item=undefined}var panel=self.toJSON();if(item){panel.item=item;panel.type=undefined}console.log("panel",panel);app.socket.publish("get items",panel,function(panel,items){console.log("got items",panel,items);self.template.find(".hide.pre").removeClass("hide");self.template.find(".show.pre").removeClass("show").hide();self.template.find(".loading-items").hide();if(items.length){self.find("create new").hide();self.find("load more").show();if(items.length<synapp["navigator batch size"]){self.find("load more").hide()}self.skip+=items.length;self.preInsertItem(items,cb)}else{self.find("create new").show();self.find("load more").hide()}})}module.exports=fill}()},{}],41:[function(require,module,exports){!function(){"use strict";var Promise=require("promise");function load(cb){var panel=this;var q=new Promise(function(fulfill,reject){if(app.cache.get("/views/Panel")){panel.template=$(app.cache.get("/views/Panel")[0].outerHTML);return fulfill(panel.template)}$.ajax({url:"/views/Panel"}).error(console.log.bind(console,"error")).success(function(data){panel.template=$(data);app.cache.set("/views/Panel",$(data));fulfill(panel.template)})});if(typeof cb==="function"){q.then(cb.bind(null,null),cb)}return q}module.exports=load}()},{promise:8}],42:[function(require,module,exports){!function(){"use strict";var Item=require("syn/components/Item/Controller");function preInsertItem(items,cb){var self=this;if(!app.cache.get("/views/Item")){return new(require("syn/components/Item/Controller"))({}).load(app.domain.intercept(function(template){self.preInsertItem(items,cb)}))}items=items.map(function(item){item=new(require("syn/components/Item/Controller"))(item);item.load(app.domain.intercept(function(template){self.find("items").append(template)}));return item});var i=0;var len=items.length;function next(){i++;if(i===len&&cb){cb()}}items.forEach(function(item){item.render(app.domain.intercept(function(args){next()}))})}module.exports=preInsertItem}()},{"syn/components/Item/Controller":29}],43:[function(require,module,exports){!function(){"use strict";module.exports=render;var Promise=require("promise");var domainRun=require("syn/lib/util/domain-run");function render(cb){var panel=this;var q=new Promise(function(fulfill,reject){domainRun(function(d){panel.find("title").text(panel.type.name);panel.find("toggle creator").on("click",function(){panel.toggleCreator($(panel))});if(!panel.template.attr("id")){panel.template.attr("id",panel.getId())}var creator=new(require("syn/components/Creator/Controller"))(panel);creator.render().then(fulfill,d.intercept.bind(d));panel.find("load more").on("click",function(){panel.fill();return false});panel.find("create new").on("click",function(){panel.find("toggle creator").click();return false});fulfill()},reject)});if(typeof cb==="function"){q.then(cb.bind(null,null),cb)}return q}}()},{promise:8,"syn/components/Creator/Controller":20,"syn/lib/util/domain-run":62}],44:[function(require,module,exports){!function(){"use strict";function toJSON(){var json={type:this.type,size:this.size,skip:this.skip};if(this.parent){json.parent=this.parent}return json}module.exports=toJSON}()},{}],45:[function(require,module,exports){!function(){"use strict";var Item=require("syn/components/Item/Controller");var Nav=require("syn/lib/util/Nav");var Edit=require("syn/components/EditAndGoAgain/Controller");function Promote(item){if(!app){throw new Error("Missing app")}var self=this;app.domain.run(function(){if(!item||!item instanceof require("syn/components/Item/Controller")){throw new Error("Item must be an Item")}self.item=item;self.template=item.find("promote");if(!self.template.length){throw new Error("Promote template not found")}self.watch=new(require("events").EventEmitter);self.$bind("limit",self.renderLimit.bind(self));self.$bind("cursor",self.renderCursor.bind(self));self.$bind("left",self.renderLeft.bind(self));self.$bind("right",self.renderRight.bind(self))})}Promote.prototype.renderLimit=function(){this.find("limit").text(this.evaluation.limit)};Promote.prototype.renderCursor=function(){this.find("cursor").text(this.evaluation.cursor)};Promote.prototype.renderLeft=function(){this.renderItem("left")};Promote.prototype.edit=function(key,value){this.evaluation[key]=value;this.watch.emit(key)};Promote.prototype.$bind=function(key,binder){this.watch.on(key,binder)};Promote.prototype.renderRight=function(){this.renderItem("right")};Promote.prototype.find=require("syn/components/Promote/controllers/find");Promote.prototype.renderItem=require("syn/components/Promote/controllers/render-item");Promote.prototype.render=require("syn/components/Promote/controllers/render");Promote.prototype.get=require("syn/components/Promote/controllers/get");Promote.prototype.finish=require("syn/components/Promote/controllers/finish");Promote.prototype.save=require("syn/components/Promote/controllers/save");module.exports=Promote}()},{events:3,"syn/components/EditAndGoAgain/Controller":26,"syn/components/Item/Controller":29,"syn/components/Promote/controllers/find":46,"syn/components/Promote/controllers/finish":47,"syn/components/Promote/controllers/get":48,"syn/components/Promote/controllers/render":50,"syn/components/Promote/controllers/render-item":49,"syn/components/Promote/controllers/save":51,"syn/lib/util/Nav":58}],46:[function(require,module,exports){!function(){"use strict";var string=require("string");function find(name,more){var comp=this;switch(name){case"item subject":return this.template.find(".subject."+more+"-item h4");case"item description":return this.template.find(".description."+more+"-item");case"cursor":return this.template.find(".cursor");case"limit":return this.template.find(".limit");case"side by side":return this.template.find(".items-side-by-side");case"finish button":return this.template.find(".finish");case"sliders":return this.find("side by side").find(".sliders."+more+"-item");case"item image":return this.find("side by side").find(".image."+more+"-item");case"item persona":return this.find("side by side").find(".persona."+more+"-item");case"item references":return this.find("side by side").find(".references."+more+"-item a");case"item persona image":return this.find("item persona",more).find("img");case"item persona name":return this.find("item persona",more).find(".user-full-name");case"item feedback":return this.find("side by side").find("."+more+"-item.feedback .feedback-entry");case"promote button":return this.find("side by side").find("."+more+"-item .promote");case"promote label":return this.find("side by side").find(".promote-label");case"edit and go again button":return this.find("side by side").find("."+more+"-item .edit-and-go-again-toggle")}}module.exports=find}()},{string:18}],47:[function(require,module,exports){!function(){"use strict";var Nav=require("syn/lib/util/Nav");function finish(){var promote=this;promote.find("promote button").off("click");promote.find("finish button").off("click");if(promote.evaluation.left){this.save("left")}if(promote.evaluation.right){this.save("right")}Nav.unreveal(promote.template,promote.item.template,app.domain.intercept(function(){promote.item.details.get();promote.item.find("toggle details").click();promote.item.find("details").find(".feedback-pending").removeClass("hide");promote.evaluation=null}))}module.exports=finish}()},{"syn/lib/util/Nav":58}],48:[function(require,module,exports){!function(){"use strict";function get(cb){var promote=this;if(!this.evaluation){app.socket.publish("get evaluation",this.item.item._id,function(evaluation){console.info("got evaluation",evaluation);promote.evaluation=evaluation;var limit=5;if(evaluation.items.length<6){limit=evaluation.items.length-1;if(!evaluation.limit&&evaluation.items.length===1){limit=1}}promote.edit("limit",limit);promote.edit("cursor",1);promote.edit("left",evaluation.items[0]);promote.edit("right",evaluation.items[1]);cb()})}else{cb()}}module.exports=get}()},{}],49:[function(require,module,exports){!function(){"use strict";var Nav=require("syn/lib/util/Nav");var Edit=require("syn/components/EditAndGoAgain/Controller");function renderItem(hand){var promote=this;var reverse=hand==="left"?"right":"left";console.info("evaluation",this.evaluation);if(!this.evaluation[hand]){this.find("item subject",hand).hide();this.find("item description",hand).hide();this.find("item feedback",hand).hide();this.find("sliders",hand).hide();this.find("promote button",hand).hide();this.find("promote label").hide();this.find("edit and go again button",hand).hide();this.find("promote button",reverse).hide();this.find("edit and go again button",reverse).hide();return}app.socket.emit("add view",this.evaluation[hand]._id);console.log("item subject",hand,this.find("item subject",hand));this.find("item subject",hand).text(this.evaluation[hand].subject);this.find("item description",hand).text(this.evaluation[hand].description);this.find("item image",hand).empty().append(new(require("syn/components/Item/Controller"))(this.evaluation[hand]).media());if(this.evaluation[hand].references&&this.evaluation[hand].references.length){this.find("item references",hand).attr("href",this.evaluation[hand].references[0].url).text(this.evaluation[hand].references[0].title||this.evaluation[hand].references[0].url)}promote.find("sliders",hand).find(".criteria-name").each(function(i){var cid=i;if(cid>3){cid-=4}promote.find("sliders",hand).find(".criteria-name").eq(i).on("click",function(){var self=$(this);var descriptionSection=self.closest(".criteria-wrapper").find(".criteria-description-section");self.closest(".row-sliders").find(".criteria-name.info").removeClass("info").addClass("shy");if($(this).hasClass("shy")){$(this).removeClass("shy").addClass("info")}else if($(this).hasClass("info")){$(this).removeClass("info").addClass("shy")}Nav.hide(self.closest(".promote").find(".criteria-description-section.is-shown"),app.domain.intercept(function(){Nav.toggle(descriptionSection)}))}).text(promote.evaluation.criterias[cid].name);promote.find("sliders",hand).find(".criteria-description").eq(i).text(promote.evaluation.criterias[cid].description);promote.find("sliders",hand).find("input").eq(i).val(0).data("criteria",promote.evaluation.criterias[cid]._id)});promote.find("item feedback",hand).val("");promote.find("item feedback",hand).removeClass("do-not-save-again");promote.find("promote button",hand).text(this.evaluation[hand].subject).off("click").on("click",function(){var left=$(this).closest(".left-item").length;var opposite=left?"right":"left";Nav.scroll(promote.template,app.domain.intercept(function(){if(promote.evaluation.cursor<promote.evaluation.limit){promote.edit("cursor",promote.evaluation.cursor+1);app.socket.emit("promote",promote.evaluation[left?"left":"right"]._id);promote.save(left?"left":"right");$.when(promote.find("side by side").find("."+opposite+"-item").animate({opacity:0})).then(function(){promote.edit(opposite,promote.evaluation.items[promote.evaluation.cursor]);promote.find("side by side").find("."+opposite+"-item").animate({opacity:1})})}else{promote.finish()}}))});promote.find("edit and go again button",hand).on("click",function(){Nav.unreveal(promote.template,promote.item.template,app.domain.intercept(function(){if(promote.item.find("editor").find("form").length){console.warn("already loaded")}else{var edit=new Edit(promote.item);edit.get(app.domain.intercept(function(template){promote.item.find("editor").find(".is-section").append(template);Nav.reveal(promote.item.find("editor"),promote.item.template,app.domain.intercept(function(){Nav.show(template,app.domain.intercept(function(){edit.render()}))}))}))}}))})}module.exports=renderItem}()},{"syn/components/EditAndGoAgain/Controller":26,"syn/components/Item/Controller":29,"syn/lib/util/Nav":58}],50:[function(require,module,exports){!function(){"use strict";var Nav=require("syn/lib/util/Nav");function render(cb){var promote=this;promote.find("finish button").on("click",function(){Nav.scroll(promote.template,app.domain.intercept(function(){if(promote.evaluation.cursor<promote.evaluation.limit){promote.save("left");promote.save("right");$.when(promote.find("side by side").find(".left-item, .right-item").animate({opacity:0},1e3)).then(function(){promote.edit("cursor",promote.evaluation.cursor+1);promote.edit("left",promote.evaluation.items[promote.evaluation.cursor]);promote.edit("cursor",promote.evaluation.cursor+1);promote.edit("right",promote.evaluation.items[promote.evaluation.cursor]);promote.find("side by side").find(".left-item").animate({opacity:1},1e3);promote.find("side by side").find(".right-item").animate({opacity:1},1e3)})}else{promote.finish()}}))})}module.exports=render}()},{"syn/lib/util/Nav":58}],51:[function(require,module,exports){!function(){"use strict";function save(hand){var promote=this;var feedback=promote.find("item feedback",hand);if(feedback.val()){if(!feedback.hasClass("do-not-save-again")){app.socket.emit("insert feedback",{item:promote.evaluation[hand]._id,user:synapp.user,feedback:feedback.val()});feedback.addClass("do-not-save-again")}}var votes=[];promote.template.find(".items-side-by-side:visible ."+hand+'-item input[type="range"]:visible').each(function(){var vote={item:promote.evaluation[hand]._id,user:synapp.user,value:+$(this).val(),criteria:$(this).data("criteria")};votes.push(vote)});app.socket.emit("insert votes",votes)}module.exports=save}()},{}],52:[function(require,module,exports){!function(){"use strict";var Nav=require("syn/lib/util/Nav");var login=require("syn/components/Login/Controller");var join=require("syn/components/Join/Controller");var forgotPassword=require("syn/components/ForgotPassword/Controller");function Sign(){}Sign.dialog={login:function(){vex.defaultOptions.className="vex-theme-flat-attack";
vex.dialog.confirm({afterOpen:function($vexContent){$(".login-button").off("click").on("click",function(){vex.close()});login($vexContent);$vexContent.find(".forgot-password-link").on("click",function(){Sign.dialog.forgotPassword();vex.close($vexContent.data().vex.id);return false})},afterClose:function(){$(".login-button").on("click",Sign.dialog.login)},message:$("#login").text(),buttons:[$.extend({},vex.dialog.buttons.NO,{text:"x Close"})]})},join:function(){vex.defaultOptions.className="vex-theme-flat-attack";vex.dialog.confirm({afterOpen:function($vexContent){$(".join-button").off("click").on("click",function(){vex.close()});join($vexContent)},afterClose:function(){$(".join-button").on("click",Sign.dialog.join)},message:$("#join").text(),buttons:[$.extend({},vex.dialog.buttons.NO,{text:"x Close"})],callback:function(value){return console.log(value?"Successfully destroyed the planet.":"Chicken.")},defaultOptions:{closeCSS:{color:"red"}}})},forgotPassword:function(){console.log("helllo");vex.defaultOptions.className="vex-theme-flat-attack";vex.dialog.confirm({afterOpen:function($vexContent){$(".forgot-password-link").off("click").on("click",function(){vex.close();return false});forgotPassword($vexContent)},afterClose:function(){$(".forgot-password-link").on("click",Sign.dialog.forgotPassword)},message:$("#forgot-password").text(),buttons:[$.extend({},vex.dialog.buttons.NO,{text:"x Close"})],callback:function(value){return console.log(value?"Successfully destroyed the planet.":"Chicken.")},defaultOptions:{closeCSS:{color:"red"}}});return false}};Sign.prototype.render=function(){app.socket.on("online users",function(online){$(".online-users").text(online)});$(".topbar-right").removeClass("hide");if(!synapp.user){$(".login-button").on("click",Sign.dialog.login);$(".join-button").on("click",Sign.dialog.join);$(".topbar .is-in").hide()}else{$(".topbar .is-out").remove()}};module.exports=Sign}()},{"syn/components/ForgotPassword/Controller":28,"syn/components/Join/Controller":37,"syn/components/Login/Controller":38,"syn/lib/util/Nav":58}],53:[function(require,module,exports){!function(){"use strict";function YouTube(url){var self=this;var youtube;var regexYouTube=/youtu\.?be.+v=([^&]+)/;if(regexYouTube.test(url)){url.replace(regexYouTube,function(m,v){youtube=v});if(synapp.env==="development"){return}var video_container=$('<div class="video-container"></div>');video_container.append($('<iframe frameborder="0" width="300" height="175" allowfullscreen></iframe>'));video_container.find("iframe").attr("src","http://www.youtube.com/embed/"+youtube+"?autoplay=0");return video_container;var div=$("<div></div>");div.addClass("youtube-preview");div.data("video",youtube);var img=$("<img>");img.attr({alt:"YouTube",src:"http://img.youtube.com/vi/"+youtube+"/hqdefault.jpg"});img.addClass("img-responsive youtube-thumbnail");var button=$("<button></button>");button.addClass("icon-play shy");var i=$("<i></i>");i.addClass("fa fa-youtube-play fa-3x");button.append(i);div.append(img,button);Play(div);return div}}function resize(elem){var img=elem.find("img");var icon=elem.find(".icon-play");var h=icon.height();icon.css({top:img.offset().top+img.height()/2-h/2+"px"});icon.width(width)}function Play(elem){var img=elem.find("img");var icon=elem.find(".icon-play");$(window).on("resize",function(){resize(elem)});img.on("load",function(){resize(elem);icon.find(".fa").on("click",function(){var video_container=$('<div class="video-container"></div>');var preview=$(this).closest(".youtube-preview");preview.empty().append(video_container);video_container.append($('<iframe frameborder="0" width="300" height="175" allowfullscreen></iframe>'));video_container.find("iframe").attr("src","http://www.youtube.com/embed/"+preview.data("video")+"?autoplay=1")})})}module.exports=YouTube}()},{}],54:[function(require,module,exports){!function(){"use strict";function Cache(){this.entries={}}Cache.prototype.get=function(key){return this.entries[key]};Cache.prototype.set=function(key,value){return this.entries[key]=value};module.exports=Cache}()},{}],55:[function(require,module,exports){!function(){"use strict";function Session(){}Session.isIn=function(){return app.socket.synuser};module.exports=Session}()},{}],56:[function(require,module,exports){!function(){"use strict";function Socket(emit){var self=this;self.socket=io.connect("http://"+window.location.hostname+":"+window.location.port);self.socket.once("welcome",function(user){emit("ready",user);if(user){console.info("Welcome",user);$("a.is-in").css("display","inline");self.socket.synuser=user}});self.socket.publish=function(event){var args=[];var done;for(var i in arguments){if(+i){if(typeof arguments[i]==="function"){done=arguments[i]}else{args.push(arguments[i])}}}self.socket.emit.apply(self.socket,[event].concat(args));self.socket.on("OK "+event,done)};self.socket.on("error",function onSocketError(error){console.error("socket error",error)})}module.exports=Socket}()},{}],57:[function(require,module,exports){!function(){"use strict";var domainRun=require("syn/lib/util/domain-run");function Form(form){var self=this;domainRun(function(d){console.log("new form",form);self.form=form;self.labels={};self.form.find("[name]").each(function(){self.labels[$(this).attr("name")]=$(this)});console.info("form["+form.attr("name")+"]","labels",self.labels);self.form.find("input").on("keydown",function(e){if(e.keyCode===13){return false}});self.form.on("submit",function(e){setTimeout(function(){self.submit(e)});return false})})}Form.prototype.submit=function(e){console.warn("form submitting",this.form.attr("name"),e);var self=this;var errors=[];self.form.find("[required]").each(function(){var val=$(this).val();if(!val){if(!errors.length){$(this).addClass("error").focus()}errors.push({required:$(this).attr("name")})}else{$(this).removeClass("error")}});if(!errors.length){this.ok()}return false};Form.prototype.send=function(fn){this.ok=fn;return this};module.exports=Form}()},{"syn/lib/util/domain-run":62}],58:[function(require,module,exports){(function(process){!function(){"use strict";function toggle(elem,poa,cb){if(!elem.hasClass("is-toggable")){elem.addClass("is-toggable")}if(elem.hasClass("is-showing")||elem.hasClass("is-hiding")){var error=new Error("Animation already in progress");error.code="ANIMATION_IN_PROGRESS";return cb(error)}if(elem.hasClass("is-shown")){unreveal(elem,poa,cb)}else{reveal(elem,poa,cb)}}function reveal(elem,poa,cb){var emitter=new(require("events").EventEmitter);if(typeof cb!=="function"){cb=console.log.bind(console)}emitter.revealed=function(fn){emitter.on("success",fn);return this};emitter.error=function(fn){emitter.on("error",fn);return this};setTimeout(function(){if(!elem.hasClass("is-toggable")){elem.addClass("is-toggable")}console.log("%c reveal","font-weight: bold",elem.attr("id")?"#"+elem.attr("id")+" ":"<no id>",elem.attr("class"));if(elem.hasClass("is-showing")||elem.hasClass("is-hiding")){var error=new Error("Animation already in progress");error.code="ANIMATION_IN_PROGRESS";return cb(error)}elem.removeClass("is-hidden").addClass("is-showing");if(poa){scroll(poa,function(){show(elem,function(){emitter.emit("success");cb()})})}else{show(elem,function(){emitter.emit("success");cb()})}});return emitter}function unreveal(elem,poa,cb){if(!elem.hasClass("is-toggable")){elem.addClass("is-toggable")}console.log("%c unreveal","font-weight: bold",elem.attr("id")?"#"+elem.attr("id")+" ":"",elem.attr("class"));if(elem.hasClass("is-showing")||elem.hasClass("is-hiding")){var error=new Error("Animation already in progress");error.code="ANIMATION_IN_PROGRESS";return cb(error)}elem.removeClass("is-shown").addClass("is-hiding");if(poa){scroll(poa,function(){hide(elem,cb)})}else{hide(elem,cb)}}function scroll(pointOfAttention,cb,speed){var emitter=new(require("events").EventEmitter);emitter.scrolled=function(fn){emitter.on("success",fn);return this};emitter.error=function(fn){emitter.on("error",fn);return this};emitter.then=function(fn,fn2){emitter.on("success",fn);if(fn2)emitter.on("error",fn2);return this};var poa=pointOfAttention.offset().top-60;var current=$("body,html").scrollTop();if(typeof cb!=="function"){cb=function(){}}if(current===poa||current>poa&&current-poa<50||poa>current&&poa-current<50){emitter.emit("success");return typeof cb==="function"?cb():true}$.when($("body,html").animate({scrollTop:poa+"px"},500,"swing")).then(function(){emitter.emit("success");if(typeof cb==="function"){cb()}});return emitter}function show(elem,cb){var emitter=new(require("events").EventEmitter);emitter.shown=function(fn){emitter.on("success",fn);return this};emitter.error=function(fn){emitter.on("error",fn);return this};setTimeout(function(){console.log("%c show","font-weight: bold",elem.attr("id")?"#"+elem.attr("id")+" ":"",elem.attr("class"));if(elem.hasClass(".is-showing")||elem.hasClass(".is-hiding")){emitter.emit("error",new Error("Already in progress"));if(typeof cb==="function"){cb(new Error("Show failed"))}return false}elem.css("margin-top","-"+elem.height()+"px");$.when(elem.find(".is-section:first").animate({marginTop:0},500)).then(function(){elem.removeClass("is-showing").addClass("is-shown");if(elem.css("margin-top")!==0){elem.animate({"margin-top":0},250)}emitter.emit("success");if(cb){cb()}});elem.animate({opacity:1},500)});return emitter}function hide(elem,cb){var emitter=new(require("events").EventEmitter);emitter.hiding=function(cb){this.on("hiding",cb);return this};emitter.hidden=function(cb){this.on("hidden",cb);return this};emitter.error=function(cb){this.on("error",cb);return this};process.nextTick(function(){var domain=require("domain").create();domain.on("error",function(error){emitter.emit("error",error)});domain.run(function(){if(!elem.length){return cb()}if(elem.hasClass(".is-showing")||elem.hasClass(".is-hiding")){emitter.emit("bounced");return false}emitter.emit("hiding");console.log("%c hide","font-weight: bold",elem.attr("id")?"#"+elem.attr("id")+" ":"",elem.attr("class"));elem.removeClass("is-shown").addClass("is-hiding");elem.find(".is-section:first").animate({"margin-top":"-"+elem.height()+"px"},1e3,function(){elem.removeClass("is-hiding").addClass("is-hidden");emitter.emit("hidden");if(cb)cb()});elem.animate({opacity:0},1e3)})});return emitter}module.exports={toggle:toggle,reveal:reveal,unreveal:unreveal,show:show,hide:hide,scroll:scroll}}()}).call(this,require("_process"))},{_process:5,domain:2,events:3}],59:[function(require,module,exports){!function(){"use strict";function spanify(des){return des.replace(/\n/g,"\n ").split(" ").map(function(word){var span=$('<span class="word"></span>');span.text(word+" ");return span})}function readMore(item,$item){var $description=$item.find(".item-description");var $image=$item.find(".item-media img");var $text=$item.find(".item-text");var $subject=$item.find(".item-subject");var $reference=$item.find(".item-reference");var $arrow=$item.find(".item-arrow");var imgHeight=$image.height();if($("body").width()<=$("#screen-tablet").width()){imgHeight*=2}var top=$text.offset().top;if($item.attr("id")!=="intro"){top-=$subject.height()}if($("body").width()>=$("#screen-tablet").width()){top-=40}else if($("body").width()>=$("#screen-phone").width()){top-=80}$description.text("");spanify(item.description).forEach(function(word){$description.append(word)});for(var i=$description.find(".word").length-1;i>=0;i--){var word=$description.find(".word").eq(i);if(word.offset().top-top>imgHeight){word.addClass("hidden-word").hide()}}if($description.find(".hidden-word").length){var more=$('<a href="#" class="more">more</a>');more.on("click",function(){if($(this).hasClass("more")){$(this).removeClass("more").addClass("less").text("less");$(this).closest(".item-description").find(".hidden-word").show()}else{$(this).removeClass("less").addClass("more").text("more");$(this).closest(".item-description").find(".hidden-word").hide()}return false});$description.append(more)}if($reference.text()&&$arrow.offset().top-$reference.offset().top<15){var more;if($description.find(".more").length){more=$description.find(".more")}else{more=$('<a href="#" class="more">more</a>');more.on("click",function(){if($(this).hasClass("more")){$(this).removeClass("more").addClass("less").text("less");$reference.show()}else{$(this).removeClass("less").addClass("more").text("more");$reference.hide()}return false})}$description.append(more);$reference.css("padding-bottom","10px").data("is-hidden-reference",true).hide()}}module.exports=readMore}()},{}],60:[function(require,module,exports){!function(){"use strict";function Stream(file){var stream=ss.createStream();ss(app.socket).emit("upload image",stream,{size:file.size,name:file.name});ss.createBlobReadStream(file).pipe(stream);return stream}module.exports=Stream}()},{}],61:[function(require,module,exports){!function(){"use strict";function Upload(dropzone,file_input,thumbnail,cb){this.dropzone=dropzone;this.file_input=file_input;this.thumbnail=thumbnail;this.cb=cb;this.init()}Upload.prototype.init=function(){if(window.File){if(this.dropzone){this.dropzone.on("dragover",this.hover.bind(this)).on("dragleave",this.hover.bind(this)).on("drop",this.handler.bind(this))}if(this.file_input){this.file_input.on("change",this.handler.bind(this))}}else{if(dropzone){dropzone.find(".modern").hide()}}};Upload.prototype.hover=function(e){e.stopPropagation();e.preventDefault()};Upload.prototype.handler=function(e){this.hover(e);var files=e.target.files||e.originalEvent.dataTransfer.files;for(var i=0,f;f=files[i];i++){this.preview(f,e.target)}};Upload.prototype.preview=function(file,target){var upload=this;var img=new Image;img.classList.add("img-responsive");img.classList.add("preview-image");img.addEventListener("load",function(){$(img).data("file",file);upload.thumbnail.empty().append(img)},false);img.src=(window.URL||window.webkitURL).createObjectURL(file);if(this.cb){this.cb(null,file)}};module.exports=Upload}()},{}],62:[function(require,module,exports){!function(){"use strict";var domain=require("domain");function domainRun(fn,reject){var d=domain.create();d.intercept=function(fn,_self){if(typeof fn!=="function"){fn=function(){}}return function(error){if(error&&error instanceof Error){self.domain.emit("error",error)}else{var args=Array.prototype.slice.call(arguments);args.shift();fn.apply(_self,args)}}};d.on("error",function onDomainError(error){console.error(error);if(error.stack){error.stack.split(/\n/).forEach(function(line){line.split(/\n/).forEach(console.warn.bind(console))})}if(typeof reject==="function"){reject(error)}});d.run(function(){fn(d)})}module.exports=domainRun}()},{domain:2}]},{},[1]);